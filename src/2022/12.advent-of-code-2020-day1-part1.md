>* Advent of Code 2020 Day1 è¯‘æ–‡ï¼ˆAdvent of Code 2020 ç¬¬ä¸€å¤©ï¼‰
>* åŸæ–‡é“¾æ¥ï¼šhttps://fasterthanli.me/series/advent-of-code-2020/part-1
>* åŸæ–‡ä½œè€…ï¼š[Amos](https://twitter.com/fasterthanlime)
>* è¯‘æ–‡æ¥è‡ªï¼šhttps://github.com/suhanyujie/article-transfer-rs/
>* è¯‘è€…ï¼š[suhanyujie](https://ishenghuo.cnblogs.com/)
>* psï¼šæ°´å¹³æœ‰é™ï¼Œå¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£
>* æ ‡ç­¾ï¼šRustï¼Œadvent of code, algo

ä»Šå¹´ 12 æœˆæˆ‘è¿˜æ²¡æœ‰å…·ä½“çš„æ‰“ç®—ï¼Œä½†æ˜¯æˆ‘å‘¨å›´çš„å¾ˆå¤šäººï¼ˆåœ¨ Twitter ä¸Šï¼Œåœ¨å·¥ä½œä¸­ï¼‰éƒ½é€‰æ‹©äº†è¿™ä¸ª [Advent of Code](https://adventofcode.com/) æ¥å­¦ä¹  Rustï¼Œè€Œä¸”æˆ‘æœ‰å¾ˆå¤§çš„ [FOMO](https://en.wikipedia.org/wiki/Fear_of_missing_out) æƒ…ç»ªï¼Œæ‰€ä»¥ï¼Œçœ‹çœ‹æœ€åæˆ‘èƒ½èµ°å¤šè¿œã€‚

æˆ‘å°†åœ¨ Linux ä¸Šå®Œæˆè¿™ä¸€ç³»åˆ—ä½œå“ï¼Œå› æ­¤å¯èƒ½ä¼šæ¶‰åŠåˆ°ä¸€äº›å‘½ä»¤è¡Œå·¥å…·ï¼Œä½†ä¸è¦æ‹…å¿ƒ â€”â€” ä»£ç ç†è®ºä¸Šèƒ½åœ¨æ‰€æœ‰å¹³å°ä¸Šè¿è¡Œã€‚

å¦‚æœä½ æƒ³ç»§ç»­ï¼Œä½ éœ€è¦å®‰è£…å¸¦æœ‰ [Rust Analyzer](https://rust-analyzer.github.io/) æ‰©å±•çš„ [VS Code](https://code.visualstudio.com/)ï¼Œå¹¶ä¸”ä½ è¿˜éœ€è¦å®‰è£… [Rust](https://rustup.rs/)ã€‚

åœ¨ Windows ä¸Šï¼Œä½ å¯èƒ½å¿…é¡»å®‰è£… VS2019 æ„å»ºå·¥å…·ï¼Œè¿™å¯èƒ½æœ‰ç‚¹çƒ¦äºº - æŠ±æ­‰ï¼

## ç¬¬ä¸€éƒ¨åˆ†
é—®é¢˜çš„è¾“å…¥ç±»ä¼¼ä¸‹æ–¹

```
1721
979
366
299
675
1456
```

æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æ‰¾åˆ°ä¸¤æ•°ç›¸åŠ çš„å’Œä¸º 2020 çš„é¡¹ï¼Œç„¶åæŠŠå®ƒä»¬ç›¸ä¹˜ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼

```shell
$ cargo new day1
     Created binary (application) `day1` package
```

é¦–å…ˆï¼Œè®©æˆ‘å°†é¢˜ç›®è¾“å…¥ç²˜è´´åˆ° `day-1/src/input.txt` æ–‡ä»¶ä¸­:

```
1470
1577
1054
(cut)
1911
1282
1306
```

ä½†ä½ çš„æ–‡ä»¶åå¯èƒ½è·Ÿæˆ‘ä¸ä¸€æ ·

ç„¶åï¼Œæˆ‘ä»¬è¦è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªé€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶å¤„ç†:

```shell
$ cargo add anyhow
    Updating 'https://github.com/rust-lang/crates.io-index' index
      Adding anyhow v1.0.35 to dependencies
```

> å°è´´å£«:
> `cargo add` ç”± [cargo-edit](https://lib.rs/crates/cargo-edit) æä¾›ï¼Œæˆ‘ä»¬å°†åœ¨æ•´ä¸ªç³»åˆ—ä¸­ä½¿ç”¨è¿™ä¸ªæ’ä»¶ã€‚
> å¦‚æœä½ æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼Œå¯ä»¥ç®€å•åœ°å®‰è£…å®ƒå¹¶ç¼–è¾‘ä¾èµ–æ–‡ä»¶
> `cargo install cargo-edit`

```rust
// in `day1/src/main.rs`

fn main() -> anyhow::Result<()> {
    let s = std::fs::read_to_string("./src/input.txt")?;
    dbg!(&s[..40]);

    Ok(())
}
```

è¿™å°†è¯»å–æ–‡ä»¶ï¼Œå¹¶æ‰“å°å‰ 40 ä¸ªå­—èŠ‚å†…å®¹ï¼š

```shell
$ cargo run --quiet
[src/main.rs:3] &s[..40] = "1470\n1577\n1054\n1962\n1107\n1123\n1683\n1680\n"
```

... ä½†æ˜¯åœ¨è¿è¡Œæ—¶æ‰“å¼€æ–‡ä»¶å¯èƒ½ä¼šå¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ `input.txt` æ–‡ä»¶æ€»æ˜¯åœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„æ—è¾¹ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¼–è¯‘æ—¶å°†å®ƒåŒ…å«è¿›å»:

```rust
fn main() -> anyhow::Result<()> {
    let s = include_str!("input.txt");
    dbg!(&s[..40]);

    Ok(())
}
```

```shell
$ cargo run --quiet
[src/main.rs:3] &s[..40] = "1470\n1577\n1054\n1962\n1107\n1123\n1683\n1680\n"
```

ç°åœ¨å­—ç¬¦ä¸²å†…å®¹æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼š

```shell
$ xxd target/debug/day1 | grep "1470.15" -A 5
0003b000: 4572 726f 723a 200a 3134 3730 0a31 3537  Error: .1470.157
0003b010: 370a 3130 3534 0a31 3936 320a 3131 3037  7.1054.1962.1107
0003b020: 0a31 3132 330a 3136 3833 0a31 3638 300a  .1123.1683.1680.
0003b030: 3131 3736 0a31 3931 370a 3137 3836 0a31  1176.1917.1786.1
0003b040: 3536 350a 3134 3634 0a31 3039 370a 3133  565.1464.1097.13
0003b050: 3633 0a31 3039 310a 3130 3732 0a31 3832  63.1091.1072.182
```

> å°è´´å£«ï¼š
> [xxd](https://linux.die.net/man/1/xxd) æ˜¯å¤§å¤šæ•° Linux å‘è¡Œç‰ˆé™„å¸¦çš„ä¸€ä¸ªéå¸¸åŸºæœ¬ï¼ˆä¸”å¤è€ï¼‰çš„ hexdump å·¥å…·ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ Stringã€‚æˆ‘ä»¬å¸Œæœ›åˆ†åˆ«å¤„ç†æ¯ä¸€è¡Œï¼Œæ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ç”¨æ¢è¡Œç¬¦å¯¹å…¶åˆ†å‰²:

```rust
fn main() -> anyhow::Result<()> {
    let s = include_str!("input.txt").split("\n");

    Ok(())
}
```

> å°è´´å£«ï¼š
> ä½ å¯èƒ½æƒ³ç”¨ `.lines()` ä»£æ›¿ `.split("\n")` è¿›è¡Œæ‹†åˆ†ï¼Œä»¥ä¾¿è¿™ä¸ CRLF è¡Œç»“æŸå…¼å®¹ï¼ˆWindowsï¼‰ã€‚æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†æ˜¯æŒ‰ç…§ `split` çš„æ€è·¯ç¼–å†™çš„ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æä¾›äº†è¿­ä»£å™¨ï¼Œæ‰€ä»¥ä½ å¯ä»¥éšä¾¿é€‰ã€‚

å®ƒç»™æˆ‘ä»¬çš„ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªå®ç°äº† `Iterator<Item = &str>` çš„å…·ä½“ç±»å‹ï¼ˆ`Split<&str>`ï¼‰ã€‚

é…·ç†Šï¼šç­‰ç­‰ï¼Œ`&str`ï¼Ÿæˆ‘ä»¬ä¸æ˜¯æœ‰ `String` å—ï¼Ÿ

Amos: çš„ç¡®å¦‚æ­¤ï¼æˆ‘ä»¬çš„è¿­ä»£å™¨ç°åœ¨è¿”å›çš„å…ƒç´ æ˜¯ä»åŸæ¥çš„ String ä¸­å€Ÿæ¥çš„ã€‚å®ƒä»¬æ˜¯æ¥è‡ªåŸå§‹ String çš„ç‰‡æ®µï¼Œå› æ­¤ä¸æ¶‰åŠå¤åˆ¶ã€‚

é…·ç†Šï¼šç­‰ç­‰ï¼Œä¸ï¼å½“æˆ‘ä»¬ä½¿ç”¨ `std::fs::read_to_string` æ—¶ï¼Œæˆ‘ä»¬ç¡®å®æœ‰ String:

![](https://fasterthanli.me/content/series/advent-of-code-2020/part-1/assets/read-to-string-is-a-string.f689393c8bab440c.avif)

ä½†æ˜¯ç­‰ç­‰... ... å½“æˆ‘ä»¬ä½¿ç”¨ `include_str!` æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯ `&str`:

![](https://fasterthanli.me/content/series/advent-of-code-2020/part-1/assets/include-str-is-a-str.4257c10addf7315d.avif)

Amos: å“¦ï¼Œå¯¹äº†ï¼å½“æˆ‘ä»¬â€œå°†å­—ç¬¦ä¸²æ‰“åŒ…è¿›åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­â€æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ä¹Ÿæ˜¯å€Ÿç”¨çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªæ˜¯ä»å¯æ‰§è¡Œæ–‡ä»¶ä¸­å€Ÿç”¨å­—ç¬¦ä¸²ã€‚

é…·ç†Šï¼šâ€œå¯æ‰§è¡Œæ–‡ä»¶â€æ˜¯æŒ‡... ? (è¦é—®ä¸€ä¸ªæœ‹å‹)

Amos: `target/debug/day1` ä¸­çš„æ–‡ä»¶æ˜¯ Linux ä¸Šçš„ [ELF](https://fasterthanli.me/series/making-our-own-executable-packer)ã€ Windows ä¸Šçš„ PE å’Œ macOS ä¸Šçš„ Mach-Oï¼Œè¿™æ˜¯ç¼–è¯‘ç¨‹åºå¾—åˆ°çš„ç»“æœï¼ˆé€šè¿‡ cargo build æˆ– cargo run æ„å»ºï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨ rustc ç¼–è¯‘å™¨ï¼‰ã€‚

é…·ç†Šï¼šå¯¹ï¼

å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ `Split<&str>`ï¼Œä¸”å®ƒå®ç°äº† `Iterator<Item = &str>`ã€‚

`Iterator` æ˜¯ä¸€ä¸ª traitï¼Œæœ€é‡è¦çš„å¿…éœ€æ–¹æ³•æ˜¯ `next()`ï¼š

```rust
fn next(&mut self) -> Option<Self::Item>
```

æ‰€ä»¥å¦‚æœæˆ‘ä»¬è°ƒç”¨ `s.next()`ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ª `Some(a_slice)`ï¼Œæˆ–è€…åœ¨å…ƒç´ è€—å°½æ—¶è¿”å› `None`ã€‚

```rust
fn main() -> anyhow::Result<()> {
    let mut s = include_str!("input.txt").split("\n");
    dbg!(s.next());
    dbg!(s.next());
    dbg!(s.next());

    Ok(())
}
```

```shell
$ cargo run --quiet
[src/main.rs:3] s.next() = Some(
    "1470",
)
[src/main.rs:4] s.next() = Some(
    "1577",
)
[src/main.rs:5] s.next() = Some(
    "1054",
)
```

é…·ç†Šï¼šç­‰ç­‰ï¼Œæˆ‘æ”¶åˆ°ä¸€ä¸ªè­¦å‘Š:

![](https://fasterthanli.me/content/series/advent-of-code-2020/part-1/assets/single-character-constant.19485d5311ae7b4b.avif)

Amos: ä½ é‡åˆ°å†…è”é”™è¯¯çš„è­¦å‘Šï¼Ÿ

é…·ç†Šï¼šæ˜¯çš„ï¼Œè¿™æ˜¯ vscode æ‰©å±• [Error Lens](https://marketplace.visualstudio.com/items?itemName=usernamehw.errorlens)ï¼Œå®ƒç›¸å½“æ•´æ´ï¼

å¥½å§ï¼Œå…³äºé‚£ä¸ªé”™è¯¯ â€”â€” å®ƒä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é”™è¯¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥è‡ª [clippy](https://github.com/rust-lang/rust-clippy) çš„è¯Šæ–­æç¤ºï¼Œè¿™...æˆ‘ä¹‹å‰è¯´è¿‡ä½ åº”è¯¥å®‰è£… clippy å§ï¼Ÿ

é‚£ä¹ˆï¼Œä½ åº”è¯¥å°†å®ƒä½œä¸º rust-analyzer é»˜è®¤çš„â€œæ£€æŸ¥ä¿å­˜â€å‘½ä»¤ï¼Œå°†å…¶ä¿å­˜åœ¨ä½ çš„ VSCode ç”¨æˆ·è®¾ç½®ä¸­ï¼š

```json
{
  "rust-analyzer.checkOnSave.command": "clippy",
}
```

clippy è¯•å›¾å‘Šè¯‰æˆ‘ä»¬çš„æ˜¯ `'\n'` åªæ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œç”¨å…¶åˆ†å‰²ä¼šè¢«é«˜åº¦ä¼˜åŒ–ï¼Œè€Œ `"\n"` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥æ˜¯ä»»æ„é•¿åº¦ï¼ˆåªä¸è¿‡è¿™é‡Œå®ƒçš„é•¿åº¦æ°å¥½æ˜¯ 1ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼ºè¿« `.split` ä½¿ç”¨æ›´é€šç”¨ï¼ˆä¼šå¯¼è‡´æ›´æ…¢ï¼‰çš„æ–¹æ³•ã€‚

æ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¿®å¤ï¼Œé€šè¿‡ç‚¹å‡»ç¼–è¾‘å™¨ä¸­çš„ç¯æ³¡ï¼ˆğŸ’¡ï¼‰å›¾æ ‡ï¼Œæˆ–åªæ˜¯æŒ‰ä¸‹ `Ctrl + .`(MacOS ä¸Šå¯èƒ½æ˜¯ `Cmd + .`ï¼‰ï¼š

![](https://fasterthanli.me/content/series/advent-of-code-2020/part-1/assets/clippy-fix.aa634c613e108047.avif)

ç„¶åæˆ‘ä»¬å¾—åˆ°ä¸‹é¢çš„ä»£ç ï¼š

```rust
fn main() -> anyhow::Result<()> {
    let mut s = include_str!("input.txt").split('\n');
    dbg!(s.next());
    dbg!(s.next());
    dbg!(s.next());

    Ok(())
}
```

æ‰§è¡Œç»“æœå’Œä¹‹å‰ä¸€æ ·ã€‚

é‚£ä¹ˆ... æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšä»€ä¹ˆå‘¢? è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹é—®é¢˜é™ˆè¿°:

> å…·ä½“æ¥è¯´ï¼Œå®ƒä»¬éœ€è¦ä½ æ‰¾åˆ°ä¸¤ä¸ªæ€»å’Œä¸º 2020 çš„æ¡ç›®ï¼Œç„¶åå°†è¿™ä¸¤ä¸ªæ•°å­—ç›¸ä¹˜ã€‚

å¯¹ï¼å°±æ˜¯æè¿°çš„é‚£æ ·ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªé—®é¢˜ â€”â€” æˆ‘ä»¬è¿˜æ²¡æœ‰æ•°å€¼ï¼Œåªæœ‰å­—ç¬¦ä¸²ã€‚

å¹¸è¿çš„æ˜¯ï¼Œ[`str::parse`](https://doc.rust-lang.org/stable/std/primitive.str.html#method.parse) å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼

é‚£ä¹ˆï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªè¿­ä»£å™¨ `Iterator<Item = &str>` å¼€å§‹ï¼Œæˆ‘ä»¬åº”è¯¥éœ€è¦ ... `Iterator<Item = i64>`ï¼Ÿ

> å°è´´å£«
> `i64` æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·çš„ 64 ä½æ•´æ•°â€”â€”å½“æˆ‘ä»¬ä¸æ‹…å¿ƒå†…å­˜ä½¿ç”¨é—®é¢˜å¹¶ä¸”ä¸ç¡®å®šèƒ½å¾—åˆ°å¤šå¤§çš„æ•°å­—æ—¶ï¼Œä½¿ç”¨å®ƒä¼¼ä¹æ˜¯ä¸€ä¸ªç›¸å¯¹å®‰å…¨çš„é€‰æ‹©ã€‚

å¯¹è¿­ä»£å™¨çš„æ‰€æœ‰é¡¹è¿›è¡Œè½¬æ¢ç§°ä¸º mappingã€‚ç”± `Iterator` trait æä¾›çš„ `.map` æ–¹æ³•å¯ä»¥å®ç° mappingã€‚

æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ é€’ä¸€ä¸ªå‡½æ•°: åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¼ é€’ `str::parse`ï¼š

```rust
fn main() -> anyhow::Result<()> {
    let mut s = include_str!("input.txt").split('\n').map(str::parse);
    dbg!(s.next());
    dbg!(s.next());
    dbg!(s.next());

    Ok(())
}
```

ä¼¼ä¹ä¸ç®¡ç”¨ï¼ŒæŠ¥é”™äº†ï¼š

```shell
$ cargo run --quiet
error[E0283]: type annotations needed for `Map<std::str::Split<'_, char>, for<'r> fn(&'r str) -> std::result::Result<F, <F as FromStr>::Err> {core::str::<impl str>::parse::<F>}>`
    --> src/main.rs:2:59
     |
2    |     let mut s = include_str!("input.txt").split('\n').map(str::parse);
     |         -----                                             ^^^^^^^^^^ cannot infer type for type parameter `F` declared on the associated function `parse`
     |         |
     |         consider giving `s` the explicit type `Map<std::str::Split<'_, char>, for<'r> fn(&'r str) -> std::result::Result<F, <F as FromStr>::Err> {core::str::<impl str>::parse::<F>}>`, where the type parameter `F` is specified
     | 
    ::: /home/amos/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/str/mod.rs:2202:21
     |
2202 |     pub fn parse<F: FromStr>(&self) -> Result<F, F::Err> {
     |                     ------- required by this bound in `core::str::<impl str>::parse`
     |
     = note: cannot satisfy `_: FromStr`
help: consider specifying the type argument in the function call
     |
2    |     let mut s = include_str!("input.txt").split('\n').map(str::parse::<F>);
     |                                                                     ^^^^^
```

è¿™ç»å¯¹æ˜¯ä¸ªå¤§é”™è¯¯ï¼Œå¤ªä¸å¯æ€è®®äº†ã€‚

ä¸è¿‡åœ¨æœ€åè¿˜æ˜¯æœ‰ç‚¹å¸®åŠ©ä¿¡æ¯ï¼š

```shell
help: consider specifying the type argument in the function call
     |
2    |     let mut s = include_str!("input.txt").split('\n').map(str::parse::<F>);
     |                                                                     ^^^^^
```

ä½ çœ‹ï¼Œ`str::parse` å¯ä»¥æŠŠä¸€ä¸ªå­—ç¬¦ä¸²è§£ææˆè®¸å¤šä¸åŒçš„ä¸œè¥¿ â€”â€” æˆ‘ä»¬å¯ä»¥è§£æä¸€ä¸ª IP åœ°å€ï¼Œæ¯”å¦‚ `127.0.0.1`ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥è§£ææˆä¸€ä¸ªæµ®ç‚¹å€¼ï¼Œæ¯”å¦‚ `3.1415926535`ï¼Œè¯¸å¦‚æ­¤ç±»ã€‚

å› æ­¤ï¼Œå€ŸåŠ©æˆ‘ä»¬çš„æœ‹å‹ [turbo-fish](https://turbo.fish/) çš„ä¸€ç‚¹å¸®åŠ©ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°è¯´: æˆ‘ä»¬æƒ³è¦è§£æçš„æ˜¯ä¸€ä¸ª `i64` â€”â€” ä¸€ä¸ªæœ‰ç¬¦å·çš„ 64 ä½æ•´æ•°ï¼š

```rust
fn main() -> anyhow::Result<()> {
    let mut s = include_str!("input.txt").split('\n').map(str::parse::<i64>);
    dbg!(s.next());
    dbg!(s.next());
    dbg!(s.next());

    Ok(())
}
```

ç„¶åå®ƒå°±èƒ½æ­£å¸¸æ‰§è¡Œäº†ï¼š

```shell
$ cargo run --quiet
[src/main.rs:3] s.next() = Some(
    Ok(
        1470,
    ),
)
[src/main.rs:4] s.next() = Some(
    Ok(
        1577,
    ),
)
[src/main.rs:5] s.next() = Some(
    Ok(
        1054,
    ),
)
```

æˆ‘ä»¬æ‰€åšçš„ä¸ä¸‹é¢çš„ JavaScript ä»£ç ç±»ä¼¼ï¼Œä½†å¹¶ä¸å®Œå…¨ç›¸åŒ:

```js
["12", "34", "56"].map((x) => parseInt(x, 10))
```

> é…·ç†Šå°è´´å£«
> é€šè¿‡ JavaScript ä»£ç å¯çŸ¥: `parseInt` æ¥å—å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬è¦è§£æçš„æ•°å­—çš„åŸºæ•°ï¼ˆradixï¼‰ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½åªæ˜¯å°†å…¶ä¼ é€’ç»™ mapï¼Œåè€…å°†ä¼ é€’é¡¹å’Œç´¢å¼•ã€‚
> è¿™ä¸ªæ–¹æ³•æœ‰æ•ˆï¼š

```shell
> ["12", "34", "56"].map((x) => parseInt(x, 10))
[ 12, 34, 56 ]
```

> ä½†ä¸‹é¢è¿™ç§æ–¹å¼å°±ä¸è¡Œï¼š

```shell
> ["12", "34", "56"].map(parseInt)
[ 12, NaN, NaN ]
```

> å®ƒåªå¯¹ç¬¬ä¸€ä¸ªï¼ˆç´¢å¼• 0ï¼‰å’Œç¬¬åä¸€ä¸ªï¼ˆç´¢å¼• 10ï¼‰å…ƒç´ æ­£å¸¸å·¥ä½œï¼Œå¦åˆ™å®ƒå°†å°è¯•ä»¥ 1 ä¸ºåŸºæ•°ã€ä»¥ 2 ä¸ºåŸºæ•°ã€ä»¥ 3 ä¸ºåŸºæ•°ç­‰ 11 ä¸ªå…ƒç´ è¿›è¡Œè§£æã€‚
> JavaScript å¾ˆæœ‰è¶£å§ï¼Ÿ

å› ä¸ºåœ¨ JavaScript ä¸­ï¼Œmap æ“ä½œä¸€ä¸ªæ•°ç»„å¹¶è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚

ä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨: item æµã€‚æˆ‘ä»¬è¿˜ä¸èƒ½éšæœºè®¿é—®ä»–ä»¬æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ‰“åå¤è°ƒç”¨ `.next()` ï¼Œå¹¶ä¸”ç›´åˆ°å®ƒä»¬è¿”å› `None`ã€‚

äº‹å®ä¸Šï¼Œå¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯Ÿæˆ‘ä»¬çš„è¾“å‡ºï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æ¯æ¬¡æ‰“å°çš„å†…å®¹å®é™…ä¸Šæ˜¯ä¸€ä¸ª `Option<Result<i64, E>>`

```
[src/main.rs:3] s.next() = Some(
    Ok(
        1470,
    ),
)
```

> å°è´´å£«
> `Option<T>` å¯ä»¥æ˜¯ Some(T) ï¼Œä¹Ÿå¯ä»¥æ˜¯ `None` â€”â€” `iter.next()` å½“æ²¡æœ‰item æ—¶å°†è¿”å› `None`ã€‚
> `Result<T, E>` å¯ä»¥æ˜¯ `Ok(T)` æˆ– `Err(E)` â€”â€” é¢˜ç›®ä¸­è¾“å…¥çš„æ‰€æœ‰çš„è¡Œéƒ½æ˜¯æ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªä¼šå¾—åˆ° `Ok(i64)`ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€æ ·æ‰èƒ½å¾—åˆ°â€œä¸€ç»„æ•°å­—â€å‘¢ï¼Ÿ

å¦‚æœæˆ‘ä»¬åœ¨ `s.next()` çš„ç»“æœä¸Šè°ƒç”¨ `.unwrap()` çš„è¯ï¼Œæˆ‘ä»¬å°†ä» `Option<Result<i64, E>>` è½¬æ¢ä¸º `Result<i64, E>`ï¼š

```rust
fn main() -> anyhow::Result<()> {
    let mut s = include_str!("input.txt").split('\n').map(str::parse::<i64>);
    dbg!(s.next().unwrap());
    dbg!(s.next().unwrap());
    dbg!(s.next().unwrap());

    Ok(())
}
```

```shell
cargo run --quiet
[src/main.rs:5] s.next().unwrap() = Ok(
    1470,
)
[src/main.rs:6] s.next().unwrap() = Ok(
    1577,
)
[src/main.rs:7] s.next().unwrap() = Ok(
    1054,
)
```

å¦‚æœæˆ‘ä»¬å†æ¬¡è°ƒç”¨ `.unwrap()`ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šå¾—åˆ°å•çº¯çš„ `i64` å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```rust
fn main() -> anyhow::Result<()> {
    let mut s = include_str!("input.txt").split('\n').map(str::parse::<i64>);
    dbg!(s.next().unwrap().unwrap());
    dbg!(s.next().unwrap().unwrap());
    dbg!(s.next().unwrap().unwrap());

    Ok(())
}
```

```shell
cargo run --quiet
[src/main.rs:3] s.next().unwrap().unwrap() = 1470
[src/main.rs:4] s.next().unwrap().unwrap() = 1577
[src/main.rs:5] s.next().unwrap().unwrap() = 1054
```

é…·ç†Šï¼šå°±å·®ä¸€ç‚¹! ä½†æ˜¯... è¿™é‡Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
Amos: å½“è°ƒç”¨ `Option<T>::unwrap()` è¦ä¹ˆ panicï¼ˆå¦‚æœå®ƒé‡åˆ°äº† `None` å˜ä½“ï¼‰ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ª `T`ã€‚
é…·ç†Šï¼španicï¼Œè¿™ä¸æ˜¯å¾ˆç³Ÿå—ï¼Ÿ
Amos: æ²¡é‚£ä¹ˆç³Ÿå•¦ï¼åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œå¦‚æœå…¶ä¸­ä¸€è¡Œä¸æ˜¯æ•°å­—ï¼Œæˆ‘ä»¬å°±ä¸èƒ½åšä»»ä½•æœ‰ç”¨çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨å®‰å…¨åœ°åœæ­¢ç¨‹åº â€”â€” ä¹Ÿå°±æ˜¯ææ…Œï¼ˆpanicï¼‰ã€‚
é…·ç†Šï¼šæœ‰é“ç†ï¼Œé‚£ç¬¬äºŒæ¬¡ `unwrap()` å‘¢ï¼Ÿ
Amos: è¿™ä¸ªå®é™…ä¸Šæ˜¯ `Result<T, E>::unwrap()` â€”â€” å®ƒçš„å·¥ä½œåŸç†ä¹Ÿæ˜¯ç±»ä¼¼ã€‚å¦‚æœé‡åˆ° `Err`ï¼Œå®ƒä¼š panicï¼ˆæºå¸¦é”™è¯¯ç±»å‹ E çš„æ ¼å¼åŒ–æ¶ˆæ¯ï¼‰ã€‚å¦åˆ™ï¼Œå®ƒä¹Ÿè¿”å› `T`ã€‚
é…·ç†Šï¼šå¥½å§ã€‚å¿«é€Ÿæé—®: æˆ‘ä»¬æ˜¯å¦å¯ä»¥å°† `unwrap` ä¼ é€’ç»™ `map`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»è¿­ä»£å™¨ä¸­æ£€ç´¢æ‰€æœ‰é¡¹ç›®æ—¶æ‰§è¡Œ unwrapï¼Ÿ
Amos: æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥! è®©æˆ‘ä»¬è¯•è¯•ã€‚

```rust
fn main() -> anyhow::Result<()> {
    let mut s = include_str!("input.txt")
        .split('\n')
        .map(str::parse::<i64>)
        .map(Result::unwrap);
    dbg!(s.next().unwrap());
    dbg!(s.next().unwrap());
    dbg!(s.next().unwrap());

    Ok(())
}
```

```shell
$ cargo run --quiet
[src/main.rs:6] s.next().unwrap() = 1470
[src/main.rs:7] s.next().unwrap() = 1577
[src/main.rs:8] s.next().unwrap() = 1054
```

é…·ç†Šï¼šå¥½çš„ï¼Œé‚£ä¹ˆ...ç°åœ¨è®°ç¬”è®°ï¼Œ `s` æ˜¯ä¸€ä¸ª `Iterator<Item = i64>`ï¼Œå¯¹å—ï¼Ÿ
Amos: å¯¹ï¼
é…·ç†Šï¼šé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ unwrap å‘¢ï¼Ÿ
Amos: å—¯ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ¶ˆè€—å®Œæ‰€æœ‰çš„ item â€”â€” æ­¤æ—¶è°ƒç”¨ `.next()` ä»ç„¶è¿”å› `Option<i64>`ã€‚
é…·ç†Šï¼šä½ èƒ½å‘Šè¯‰æˆ‘è¿™æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆå—ï¼Ÿ

```rust
fn main() -> anyhow::Result<()> {
    let mut s = include_str!("input.txt")
        .split('\n')
        .map(str::parse::<i64>)
        .map(Result::unwrap)
        .skip(198); // new!

    dbg!(s.next().unwrap());
    dbg!(s.next().unwrap());
    dbg!(s.next().unwrap());

    Ok(())
}
```

```shell
$ cargo run --quiet
[src/main.rs:8] s.next().unwrap() = 1282
[src/main.rs:9] s.next().unwrap() = 1306
thread 'main' panicked at 'called `Option::unwrap()` on a `None` value', src/main.rs:10:19
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

é…·ç†Šï¼šå“¦ï¼Œå¯¹äº†ï¼Œæˆ‘ä»¬çš„ `input.txt` æ–‡ä»¶åªæœ‰ 200 è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ç»§ç»­è°ƒç”¨ `.next()`ã€‚åœ¨é‚£ä¹‹åï¼Œæˆ‘ä»¬ç»ˆäºå¾—åˆ°äº† `None`ã€‚æŠ“åˆ°ä½ äº†ã€‚

æˆ‘ä»¬å…ˆç»§ç»­è§£é¢˜

é…·ç†Šï¼šç­‰ç­‰ï¼ŒæŠ±æ­‰æ‰“æ–­ä½ ä»¬ã€‚.å¦‚æœæˆ‘ä¸æƒ³è°ƒç”¨ `Result::unwrap` â€”â€” å¦‚æœæˆ‘ä¸æƒ³ panicï¼Œè€Œæ˜¯æƒ³è¿”å›ä¸€ä¸ªç®€æ´çš„é”™è¯¯ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿ
Amos: æˆ‘ä»¬è¿‡ä¼šå„¿å†è¯´è¿™ä¸ªï¼Œæ‹‰é’©ä¿è¯ï¼
é…·ç†Šï¼šå¥½å§ã€‚

é‚£ä¹ˆï¼é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¾“å…¥ä¸­æ‰¾åˆ°ä¸€å¯¹æ•°å­—ï¼Œå®ƒä»¬çš„æ€»å’Œæ˜¯ 2020ï¼Œç„¶åå°†å®ƒä»¬ç›¸ä¹˜ã€‚

è®©æˆ‘ä»¬å°è¯•ä¸€äº›ç±»å‹é©±åŠ¨çš„å¼€å‘ï¼š

```rust
fn find_pair_whose_sum_is_2020(s: Vec<i64>) -> Option<(i64, i64)> {
    todo!()
}
```

å› æ­¤ï¼Œç»™å®šä¸€ä¸ª `Vec<i64>` â€”â€” å¯ä»¥è¯´å°±åƒæˆ‘ä»¬ä»Šå¤©æ‰€è¯´çš„â€œarrayâ€ä¸€æ ·æ¥è¿‘ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥å°è¯•æ‰¾åˆ°ä¸¤ä¸ªå’Œä¸º 2020 çš„æ•°å­—ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºå…ƒç»„è¿”å›ï¼Œå¦‚: (2019,1)ã€‚

ç„¶è€Œï¼Œå®ƒä¸æ˜¯ç®€å•åœ°è¿”å›ä¸€ä¸ª `(i64ï¼Œi64)`ï¼Œå› ä¸ºè¿™æ ·çš„ä¸€å¯¹å®Œå…¨æœ‰å¯èƒ½ä¸å­˜åœ¨ï¼å¦‚æœæˆ‘ä»¬çš„è¾“å…¥åªæ˜¯ `vec![1, 3, 5]`ï¼Œå¥½å§ï¼Œä¸¤ä¸ªæ•°å­—çš„ç»„åˆä¸ä¼šç­‰äº 2020ã€‚

åœ¨å®ç°è¿™ä¸ªå‡½æ•°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å°è¯•å¼„æ¸…æ¥šå¦‚ä½•ä½¿ç”¨å®ƒã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ª `Iterator<Item = i64>`ã€‚ä½†æ˜¯è¿™ä¸ªå‡½æ•°å¸Œæœ›éšæœºè®¿é—®é›†åˆä¸­çš„ä»»æ„é¡¹ï¼Œæ‰€ä»¥å®ƒåªèƒ½æ˜¯ `Vec<i64>`ã€‚

[Iterator::collect](https://doc.rust-lang.org/stable/std/iter/trait.Iterator.html#method.collect) å¯ä»¥å¸®åŠ©ä½ å®Œæˆå·¥ä½œã€‚

`main` å‡½æ•°å¦‚ä¸‹ï¼š

```rust
fn main() -> anyhow::Result<()> {
    let pair = find_pair_whose_sum_is_2020(
        include_str!("input.txt")
            .split('\n')
            .map(str::parse::<i64>)
            .map(Result::unwrap)
            .collect(),
    );
    dbg!(pair);

    Ok(())
}

fn find_pair_whose_sum_is_2020(s: Vec<i64>) -> Option<(i64, i64)> {
    todo!()
}
```

ç¼–è¯‘åï¼š

```shell
$ cargo check
    Finished dev [unoptimized + debuginfo] target(s) in 0.01s
```

ä½†å®ƒä¸èƒ½è¿è¡Œ:

```shell
$ cargo run --quiet
thread 'main' panicked at 'not yet implemented', src/main.rs:17:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

é…·ç†Šï¼šå“¦ï¼Œ`todo!()` æ˜¯ç­‰å¾…æˆ‘ä»¬å»å®ç°çš„å—ï¼Ÿ
Amos: å¯¹ï¼å®ƒå…è®¸æˆ‘ä»¬å°†æŸäº›å†…å®¹æ ‡è®°ä¸ºâ€œå¾…å®Œæˆâ€ï¼Œå¹¶ä¸”å®ƒå°†è¿›è¡Œç¼–è¯‘ï¼ˆè€Œä¸æ˜¯æŠ±æ€¨æˆ‘ä»¬æ²¡æœ‰è¿”å›æ­£ç¡®çš„ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬è®© `find_pair_whose_sum_is_2020` å‡½æ•°ä½“ç›´æ¥ä¸ºç©ºï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ï¼‰
é…·ç†Šï¼šå¤ªæ£’äº†ï¼Œä½†ç»“å°¾ä¸ºä½•æ˜¯ä¸ª `!`ï¼Ÿ
Amos: å› ä¸ºå®ƒæ˜¯[å®](https://doc.rust-lang.org/book/ch19-06-macros.html)ï¼Œä¸æ˜¯å‡½æ•°ã€‚

ç°åœ¨æˆ‘ä»¬è¦åšçš„å°±æ˜¯å®ç°è¿™ä¸ªå‡½æ•°ï¼

`Vec<i64>` å¯ä»¥è§†ä¸ºä¸€ç§æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è°ƒç”¨ `.len()`ï¼Œç”¨äºè¿”å›å®ƒæ‰€æ‹¥æœ‰çš„æ¡ç›®æ•°ï¼Œç±»å‹æ˜¯ `usize`ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `[]` å¯¹å®ƒè¿›è¡Œç´¢å¼•å–å€¼ï¼Œå°±åƒåœ¨ JavaScript ä¸­ä¸€æ ·ã€‚

è®©æˆ‘ä»¬è¯•ä¸€è¯•:

```rust
fn find_pair_whose_sum_is_2020(s: Vec<i64>) -> Option<(i64, i64)> {
    for i in 0..s.len() {
        for j in 0..s.len() {
            if i == j {
                continue;
            }
            if s[i] + s[j] == 2020 {
                return Some((s[i], s[j]));
            }
        }
    }
    None
}
```

é…·ç†Šï¼šè¿™æ˜¯æ€ä¹ˆå›äº‹? åµŒå¥—å¾ªç¯ï¼Ÿ
Amos: æ˜¯çš„ï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥æ‰€æœ‰å¯èƒ½çš„æ•°å­—å¯¹ã€‚
é…·ç†Šï¼šcontinue æ˜¯å› ä¸º...ï¼Ÿ
Amos: å› ä¸ºå¦‚æœæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªé¡¹æ˜¯ 1010ï¼Œæˆ‘ä»¬å¦ä¸€ä¸ªé¡¹æ˜¯å…¶æœ¬èº«ï¼Œå¯¼è‡´å’Œä¸º 2020ã€‚é…å¯¹å¿…é¡»ç”±ä¸åŒçš„å…ƒç´ ç»„æˆã€‚
é…·ç†Šï¼šåŸæ¥å¦‚æ­¤ã€‚

ä¸Šé¢è¿™ä¸ªè§£å†³æ–¹æ¡ˆçœŸçš„æœ‰æ•ˆï¼

```shell
$ cargo run --quiet
[src/main.rs:11] pair = Some(
    (
        376,
        1644,
    ),
)

$ echo $((376 + 1644))
2020
```

é…·ç†Šï¼šæ£’ï¼å¯ä»¥æ”¹è¿›å—ï¼Ÿ
Amos: æˆ‘æƒ³åšä¸€äº›æ”¹è¿›ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å®é™…ä¸Šè§£å†³é…·ç†Šçš„åˆç†è¦æ±‚â€œé€‚å½“çš„é”™è¯¯å¤„ç†â€ã€‚

æ­£å¦‚æˆ‘ä»¬ä» `Iterator<Item = i64>` æ”¶é›†åˆ°çš„ `Vec<i64>` ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°† `Iterator<Item = Result<i64, E>>` æ”¶é›†åˆ° `Result<Vec<i64>, E>` ä¸­ã€‚

é…·ç†Šï¼šæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªä¸åŒçš„ `collect` å®ç°ï¼Œå®ƒåªæ˜¯åœ¨å‡ºç°ç¬¬ä¸€ä¸ªé”™è¯¯æ—¶åœæ­¢ï¼Ÿ
Amos: æ˜¯çš„! å¦‚æœæ²¡æœ‰ä¸€ä¸ªæ¡ç›®æ˜¯ `Err` å˜ä½“ï¼Œé‚£ä¹ˆä½ å°†å¾—åˆ° `Ok(some_vec)`ï¼Œå¦åˆ™ï¼Œå°†å¾—åˆ° `Err(first_error)`ã€‚

æˆ‘ä»¬è¯•è¯•ï¼š

```rust
fn main() -> anyhow::Result<()> {
    let pair = find_pair_whose_sum_is_2020(
        include_str!("input.txt")
            .split('\n')
            .map(str::parse::<i64>)
            .collect::<Result<Vec<_>, _>>()?,
    );
    dbg!(pair);

    Ok(())
}
```

ï¼ˆè¿™æ®µä»£ç å…·æœ‰å®Œå…¨ç›¸åŒçš„è¾“å‡º â€”â€” æˆ‘å°±ä¸å±•ç¤º shell ä¼šè¯çš„æ‰§è¡Œç»“æœäº†ã€‚ï¼‰

é…·ç†Šï¼šä¸é”™! è¿˜æœ‰ï¼Œé‚£æœ‰æ¡å¤§ turbofishã€‚
åœ¨ `collect()` ä¹‹åä¸ºä½•è¿˜æœ‰ `?`ï¼Ÿ

Amos: åœ¨æŸç§æ„ä¹‰ä¸Šï¼Œå®ƒæœ‰ç‚¹ç±»ä¼¼äº `unwrap()`ï¼Œåœ¨é‚£ä¸ªåœºæ™¯ä¸­ï¼Œå®ƒè¿”å›çš„æ˜¯ `Result<T, E>` å’Œ â€œreturnâ€ï¼ˆå®é™…ä¸Šæ˜¯ â€œevaluates toâ€ï¼‰`T`ã€‚

é…·ç†Šï¼šä½†å®ƒä¸ä¼š panic å—ï¼Ÿ
Amos: å®ƒä¸ä¼š panicï¼Œå¦‚æœ `Result` æ˜¯ Err å˜ä½“ï¼Œå®ƒè¿”å›ä¸€ä¸ª `Err(E)`ã€‚

é…·ç†Šï¼šå•Šï¼Œæ‰€ä»¥å®ƒåªèƒ½åœ¨è¿”å› `Result<T, E>` çš„å‡½æ•°ä¸­å·¥ä½œï¼Ÿ
Amos: å¯¹ï¼
é…·ç†Šï¼šä½†æ˜¯æˆ‘ä»¬çš„å‡½æ•°è¿”å›ç±»å‹æ˜¯ `anyhow::Result<()>`ï¼Œå“ªé‡Œæœ‰ `E`ï¼Ÿ
Amos: å¥½å§ï¼Œ`anyhow` æ˜¯ä¸€ä¸ªæœ‰åŠ©äºé”™è¯¯å¤„ç†çš„æ¿æ¡ç®±ï¼ˆcrateï¼‰â€”â€” å®ƒé™„å¸¦äº†ä¸€ä¸ªé”™è¯¯ç±»å‹ï¼Œå¯ä»¥åŒ…å«å…¶ä»–ä»»ä½•é”™è¯¯ï¼ŒçœŸçš„ã€‚
å› æ­¤ï¼Œ`anyhow::Result ` çš„å®šä¹‰å®é™…ä¸Šæ˜¯:

```rust
pub type Result<T, E = Error> = core::result::Result<T, E>;
```

æ— è®ºå¦‚ä½•ï¼Œè¿™é‡Œçš„ `Error` æ˜¯ `anyhow::Error`ã€‚

é…·ç†Šï¼šå¥½çš„ï¼Œé‚£ä¹ˆ `Result<()>` ä¸­çš„ `()` æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ
Amos: ç©ºå…ƒç»„ï¼
çœ‹çœ‹æˆ‘ä»¬çš„ `find_pair_whose_sum_is_2020` å‡½æ•°æ˜¯å¦‚ä½•è¿”å› `Option<(i64, i64)>` çš„ã€‚

é…·ç†Šï¼šé‚£ç±»å‹ `()`ï¼Œå¤§å°æ˜¯å¤šå°‘..ã€‚
Amos: å¤§å°ä¸ºé›¶ï¼Œæ²¡æœ‰å¼€é”€ã€‚

å¥½äº†ï¼Œæˆ‘ä»¬çš„ä»£ç æ²¡é—®é¢˜ï¼Œæˆ‘æƒ³:

```rust
fn main() -> anyhow::Result<()> {
    let pair = find_pair_whose_sum_is_2020(
        include_str!("input.txt")
            .split('\n')
            .map(str::parse::<i64>)
            .collect::<Result<Vec<_>, _>>()?,
    );
    dbg!(pair);

    Ok(())
}

fn find_pair_whose_sum_is_2020(s: Vec<i64>) -> Option<(i64, i64)> {
    for i in 0..s.len() {
        for j in 0..s.len() {
            if i == j {
                continue;
            }
            if s[i] + s[j] == 2020 {
                return Some((s[i], s[j]));
            }
        }
    }
    None
}
```

ä½†æˆ‘æƒ³ç»™ä½ ä»¬çœ‹æ›´å¤šçš„ä¸œè¥¿ã€‚

çœ‹ï¼Œ`find_pair_whose_sum_is_2020` æœ‰ç‚¹å›°æ‰°æˆ‘ã€‚ä½ çŸ¥é“ä»€ä¹ˆä¼šå¾ˆé…·å—? ä¸€ä¸ªè¿”å›â€œç»“æœå¯¹â€çš„å‡½æ•°ï¼Œåƒè¿™æ ·:

```rust
fn pairs(s: Vec<i64>) -> Vec<(i64, i64)> {
    todo!()
}
```

é…·ç†Šï¼šå—¯ã€‚æˆ‘ä»¬çœŸçš„éœ€è¦åœ¨è¿™é‡Œä½¿ç”¨ `Vec<i64>` å—ï¼Ÿå…¶ä»–é›†åˆç±»å‹å‘¢ï¼Ÿä¾‹å¦‚ï¼Œ`[i64; 12]`ç±»å‹å¦‚æœä½¿ç”¨è¿™ç§æ–¹æ³•ä¼šä¸ç”Ÿæ•ˆå—ï¼Ÿå›ºå®šå¤§å°çš„æ•°ç»„ï¼Ÿ
Amos: æœ‰å¯èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡ï¼ˆsliceï¼‰æ›¿ä»£ã€‚

```rust
fn all_pairs(s: &[i64]) -> Vec<(i64, i64)> {
    todo!()
}
```

è®©æˆ‘ä»¬çœŸæ­£å®ç°å®ƒ:

```rust
fn all_pairs(s: &[i64]) -> Vec<(i64, i64)> {
    let mut pairs: Vec<_> = Default::default();
    for i in 0..s.len() {
        for j in 0..s.len() {
            pairs.push((s[i], s[j]))
        }
    }
    pairs
}
```

ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ `find_pair_whose_sum_is_2020` ä¸­ä½¿ç”¨å®ƒ:

```rust
fn find_pair_whose_sum_is_2020(s: Vec<i64>) -> Option<(i64, i64)> {
    for (a, b) in all_pairs(&s[..]) {
        if a + b == 2020 {
            return Some((a, b));
        }
    }
    None
}
```

é‚£ä¸ªç‰ˆæœ¬ä»ç„¶æ­£å¸¸æ‰§è¡Œï¼

é…·ç†Šï¼šä¸é”™ï¼Œä¸è¿‡æˆ‘åœ¨æƒ³... å¦‚æœæˆ‘ä»¬æ—©ç‚¹æ‰¾åˆ°ç»“æœå¯¹ï¼ˆpairï¼‰å‘¢ï¼Ÿ
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åªä½¿ç”¨å‰å‡ ä¸ªç»“æœå¯¹ï¼Œé‚£ä¹ˆè®¡ç®—â€œæ‰€æœ‰çš„å¯¹â€ä¸æ˜¯å¾ˆæµªè´¹å—ï¼Ÿ

Amos: æ²¡é”™ï¼Œæœ‰ä»€ä¹ˆåŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ
é…·ç†Šï¼šé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `all_pairs` ä¸­ä¸è¿”å› `Vec<(i64, i64)>`ï¼Œè€Œæ˜¯è¿”å›... `Iterator<Item = (i64, i64)>`ï¼Ÿ

Amos: å¯ä»¥! äº‹å®ä¸Šï¼Œä½ å¯ä»¥è¿­ä»£ä¸€ä¸ª `Vec`ï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»å¯ä»¥ä½¿ç”¨â€œè¿­ä»£å™¨é£æ ¼â€ï¼ˆiterator-styleï¼‰:

```rust
fn find_pair_whose_sum_is_2020(s: Vec<i64>) -> Option<(i64, i64)> {
    all_pairs(&s[..]).into_iter().find(|(a, b)| a + b == 2020)
}
```

é…·ç†Šï¼šå“‡å“¦ï¼å³ä½¿æˆ‘ä»¬ä¸€å¼€å§‹å°±â€œæ‰¾åˆ°â€æ€»å’Œæ˜¯ 2020 çš„ç»“æœå¯¹ï¼Œæˆ‘ä»¬ä»ç„¶åœ¨æ„å»ºæ•´ä¸ª `Vec`ã€‚
Amos: æ²¡é”™ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªä¹Ÿä¿®å¤ä¸€ä¸‹ã€‚

```rust
fn all_pairs(s: &[i64]) -> impl Iterator<Item = (i64, i64)> + '_ {
    s.iter()
        .copied()
        .enumerate()
        .map(move |(a_index, a)| {
            s.iter()
                .copied()
                .enumerate()
                .filter_map(move |(b_index, b)| {
                    if a_index == b_index {
                        None
                    } else {
                        Some((a, b))
                    }
                })
        })
        .flatten()
}
```

é…·ç†Šï¼šè¿™... æœ‰ç‚¹ç²—ç³™ã€‚
æˆ‘ä»¬èƒ½æ¢ç§æ–¹å¼å†™å—ï¼Ÿ

Amos: å¯ä»¥! å½“ç„¶å¯ä»¥ã€‚æˆ–è€…æˆ‘ä»¬ä»…ä»…ä½¿ç”¨ `itertools` crate å°±èƒ½åšåˆ°ã€‚

```shell
$ cargo add itertools
      Adding itertools v0.9.0 to dependencies
```

å®ç°å˜æˆå¦‚ä¸‹æ‰€ç¤ºï¼š

```rust
use itertools::Itertools;

fn main() -> anyhow::Result<()> {
    let pair = find_pair_whose_sum_is_2020(
        include_str!("input.txt")
            .split('\n')
            .map(str::parse::<i64>)
            .collect::<Result<Vec<_>, _>>()?,
    );
    dbg!(pair);

    Ok(())
}

fn find_pair_whose_sum_is_2020(s: Vec<i64>) -> Option<(i64, i64)> {
    s.into_iter()
        .tuple_combinations()
        .find(|(a, b)| a + b == 2020)
}
```

é…·ç†Šï¼šå“‡ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬æ˜¯å¦æœ‰å¿…è¦å°† `find_pair_whose_sum_is_2020` ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Ÿ
Amos: æ²¡æœ‰å¿…è¦äº†ã€‚

```rust
use itertools::Itertools;

fn main() -> anyhow::Result<()> {
    let (a, b) = include_str!("input.txt")
        .split('\n')
        .map(str::parse::<i64>)
        .collect::<Result<Vec<_>, _>>()?
        .into_iter()
        .tuple_combinations()
        .find(|(a, b)| a + b == 2020)
        .expect("no pair had a sum of 2020");

    dbg!(a + b);
    dbg!(a * b);

    Ok(())
}
```

```shell
$ cargo run --quiet
[src/main.rs:13] a + b = 2020
[src/main.rs:14] a * b = 618144
```

é…·ç†Šï¼šå¤ªæ£’äº†ï¼
æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦é‚£ä¸ª `.collect`ï¼Ÿæˆ‘çŸ¥é“æˆ‘ä»¬éœ€è¦å¤„ç†é”™è¯¯ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½åªä½¿ç”¨åƒ [itertools::process_result](https://docs.rs/itertools/0.9.0/itertools/fn.process_results.html) è¿™æ ·çš„å·¥å…·å§ï¼Ÿ

Amos: ä¸èƒ½ï¼Œå› ä¸º [tuple_combinations](https://docs.rs/itertools/0.9.0/itertools/trait.Itertools.html#method.tuple_combinations) éœ€è¦è¿­ä»£å™¨å®ç°äº† `Clone`ã€‚

é…·ç†Šï¼šå•Šï¼Œå› ä¸ºå®ƒåœ¨è¾“å…¥ä¸­è¿­ä»£å¥½å‡ æ¬¡æ¥ç»„æˆç»„åˆ..ã€‚

Amos: ä½ æ— æ³•åªç”¨ä¸€æ¬¡è¿­ä»£æ¥å®Œæˆè¿™ä»¶äº‹ï¼Œå› ä¸ºä¸€æ—¦ä½ æ£€ç´¢åˆ°ä¸€ä¸ªå€¼ï¼Œå®ƒå°±ä¼šä»è¿­ä»£å™¨ä¸­ç§»é™¤ã€‚

é…·ç†Šï¼šç¬¬ä¸€éƒ¨åˆ†ç»“æŸäº†å—ï¼Ÿ
Amos: å¸Œæœ›å¦‚æ­¤ï¼

## ç¬¬äºŒéƒ¨åˆ†

æˆ‘ä»¬çœ‹çœ‹é—®é¢˜é™ˆè¿°çš„ç¬¬äºŒéƒ¨åˆ†:

> åœ¨ä½ çš„è´¹ç”¨æŠ¥å‘Šä¸­ï¼Œä¸‰é¡¹å’Œä¸º 2020 çš„æ‰€æœ‰ç»„åˆæœ‰å“ªäº›ï¼Ÿ

é…·ç†Šï¼šç­‰ç­‰ï¼Œç­‰ç­‰ï¼Œæˆ‘å¯ä»¥åšï¼

```rust
use itertools::Itertools;

fn main() -> anyhow::Result<()> {
    let (a, b, c) = include_str!("input.txt")
        .split('\n')
        .map(str::parse::<i64>)
        .collect::<Result<Vec<_>, _>>()?
        .into_iter()
        .tuple_combinations()
        .find(|(a, b, c)| a + b + c == 2020)
        .expect("no tuple of length 3 had a sum of 2020");

    dbg!(a + b + c);
    dbg!(a * b * c);

    Ok(())
}
```

```shell
$ cargo run --quiet
[src/main.rs:13] a + b + c = 2020
[src/main.rs:14] a * b * c = 173538720
```

Amos: å¹²å¾—å¥½ï¼Œå°ç†Š! å¾ˆå¹¸è¿æˆ‘ä»¬æœ‰ itertoolsã€‚
é…·ç†Šï¼šå†è§ï¼

*â€”â€”å®Œâ€”â€”*