>* Advent of Code 2020 Day11 è¯‘æ–‡ï¼ˆç”¨ Rust å®ç° Advent of Code 2020 ç¬¬11å¤©ï¼‰
>* åŸæ–‡é“¾æ¥ï¼šhttps://fasterthanli.me/series/advent-of-code-2020/part-11
>* åŸæ–‡ä½œè€…ï¼š[Amos](https://twitter.com/fasterthanlime)
>* è¯‘æ–‡æ¥è‡ªï¼šhttps://github.com/suhanyujie/article-transfer-rs/
>* è¯‘è€…ï¼š[suhanyujie](https://ishenghuo.cnblogs.com/)
>* psï¼šæ°´å¹³æœ‰é™ï¼Œå¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£
>* æ ‡ç­¾ï¼šRustï¼Œadvent of code, algo

æ–°çš„ä¸€å¤©ï¼Œ[æ–°çš„é—®é¢˜](https://adventofcode.com/2020/day/11)ã€‚

è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥æœ‰ç‚¹åƒâ€œ[åº·å¨ç”Ÿå‘½æ¸¸æˆâ€ï¼ˆGame of Lifeï¼‰](https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life) ï¼Œæˆ–è€…æ˜¯ä¸€ç§è€å¼çš„[ç»†èƒç”Ÿå‘½è‡ªåŠ¨æœº](https://en.wikipedia.org/wiki/Cellular_automaton)ã€‚

æˆ‘ä»¬æœ‰ä¸€å¼ è¿™æ ·çš„åœ°å›¾:

```text
L.LL.LL.LL
LLLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLLL
L.LLLLLL.L
L.LLLLL.LL
```

å¯¹äºæ¯ä¸€æ¬¡è¿­ä»£ï¼š
- å¦‚æœæ˜¯ `L` ç¬¦å·ï¼Œä¼šå˜æˆ `#`ï¼Œå¦‚æœæ²¡æœ‰å˜æˆ `#`ï¼Œåˆ™åœ¨å…¶ç›¸é‚»çš„ 8 ä¸ªä½ç½®ä¸€å®šæœ‰ä¸€ä¸ªå¯ä»¥è½¬æ¢æˆ `#`
- `#` ç¬¦å·ï¼Œåˆ™å˜æˆ `L`ï¼Œå‰ææ˜¯ç›¸é‚»ä½ç½®ä¸­æœ‰ 4 ä¸ªä»¥ä¸Šçš„å•å…ƒæ ¼æ˜¯ `#` 
- `.` ç¬¦å·ï¼Œåˆ™ä¸ä¼šæ”¹å˜

è¿™æ˜¯ä¸€ä¸ªä»¤äººæ„Ÿå…´è¶£çš„é—®é¢˜ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å›æƒ³ä¸€äº›æˆ‘ä»¬åœ¨[ç¬¬ 3 å¤©](https://fasterthanli.me/series/advent-of-code-2020/part-3)åšçš„ä¸œè¥¿ï¼

é¦–å…ˆæ˜¯ 2D vector ç±»å‹ï¼š

```rust
#[derive(Debug, Clone, Copy, PartialEq)]
struct Vec2 {
    x: i64,
    y: i64,
}
```

ç„¶åæ˜¯ tile æšä¸¾ï¼š

```rust
#[derive(Clone, Copy, PartialEq)]
enum Tile {
    Floor,
    EmptySeat,
    OccupiedSeat,
}

impl Default for Tile {
    fn default() -> Self {
        Self::Floor
    }
}
```

ä¸º Tile å®ç°ä¸€ä¸ªç®€æ´çš„ `Debug` traitï¼š

```rust
use std::fmt;

impl fmt::Debug for Tile {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        let c = match self {
            Tile::Floor => '.',
            Tile::EmptySeat => 'L',
            Tile::OccupiedSeat => '#',
        };
        write!(f, "{}", c)
    }
}
```

ç„¶åï¼Œ`Map` â€”â€” è¿™ä¸€æ¬¡ï¼Œè®©å®ƒé€šç”¨ä¸€äº›ã€‚åªæ˜¯ä¸ºäº†å¥½ç©ï¼

```rust
struct Map<T> {
    size: Vec2,
    tiles: Vec<T>,
}
```

å¦‚æœ T å®ç°äº† Default traitï¼Œå¯ä»¥å¾ˆç®€å•åœ°å®ç° `new`:

```rust
impl<T> Map<T>
where
    T: Default,
{
    fn new(size: Vec2) -> Self {
        let num_tiles = size.x * size.y;
        Self {
            size,
            tiles: (0..num_tiles)
                .into_iter()
                .map(|_| Default::default())
                .collect(),
        }
    }
}
```

ç„¶åæ˜¯ `Map::index`ï¼Œä» 2D ç©ºé—´åˆ° 1D ç©ºé—´çš„æ˜ å°„/ç´¢å¼•ï¼š

```rust
impl<T> Map<T> {
    fn index(&self, pos: Vec2) -> Option<usize> {
        if (0..self.size.x).contains(&pos.x) && (0..self.size.y).contains(&pos.y) {
            Some((pos.x + pos.y * self.size.x) as _)
        } else {
            None
        }
    }
}
```

ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç° `set`:

```rust
impl<T> Map<T> {
    fn set(&mut self, pos: Vec2, tile: T) {
        if let Some(index) = self.index(pos) {
            self.tiles[index] = tile;
        }
    }
}
```

å¯¹äº `get`ï¼Œæˆ‘ä»¬éœ€è¦ `T` æ˜¯å¯ Copy çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦ä½¿ç”¨å¼•ç”¨ï¼š

```rust
impl<T> Map<T>
where
    T: Copy,
{
    fn get(&self, pos: Vec2) -> Option<T> {
        self.index(pos).map(|index| self.tiles[index])
    }
}
```

æ¥ä¸‹æ¥ â€”â€” æˆ‘ä»¬å°†ä¸å¾—ä¸å¤„ç†é‚»è¿‘ä½ç½®ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæšä¸¾æŒ‡å®šå•å…ƒæ ¼çš„æ‰€æœ‰é‚»è¿‘ä½ç½®ï¼Œé‚£å°†ä¼šéå¸¸ç®€æ´:

```rust
impl<T> Map<T> {
    fn neighbor_positions(&self, pos: Vec2) -> impl Iterator<Item = Vec2> {
        (-1..=1)
            .map(|dx| (-1..=1).map(move |dy| (dx, dy)))
            .flatten()
            .filter(|&(dx, dy)| !(dx == 0 && dy == 0))
            .map(move |(dx, dy)| Vec2 {
                x: pos.x + dx,
                y: pos.y + dy,
            })
    }
}
```

é…·ç†Šï¼šè¿™çœ‹èµ·æ¥æœ‰ç‚¹æ¯›éª¨æ‚šç„¶ï¼Œæµ‹è¯•ä¸€ä¸‹æ€ä¹ˆæ ·ï¼Ÿ

```rust
#[test]
fn test_neighbor_positions() {
    use std::collections::HashSet;

    let map = Map::<()>::new(Vec2 { x: 3, y: 3 });
    let positions: HashSet<_> = map
        .neighbor_positions(Vec2 { x: 1, y: 1 })
        .map(|v| (v.x, v.y))
        .collect();
    for p in &[
        (0, 0),
        (0, 1),
        (0, 2),
        (1, 0),
        (2, 0),
        (1, 2),
        (2, 2),
        (2, 1),
    ] {
        assert!(positions.contains(p));
    }
}
```

```shell
$ cargo t -q

running 1 test
.
test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
```

é…·ç†Šï¼šå¥½å§ï¼Œç»§ç»­ã€‚

æ¥ä¸‹æ¥ï¼Œä¸ºäº†æ›´å¥½åœ°åº¦é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `.neighbor_tiles` æ–¹æ³•è¿”å› `Tile` çš„è¿­ä»£å™¨ï¼

```rust
impl<T> Map<T>
where
    T: Copy,
{
    fn neighbor_tiles(&self, pos: Vec2) -> impl Iterator<Item = T> + '_ {
        self.neighbor_positions(pos)
            .filter_map(move |pos| self.get(pos))
    }
}
```

é…·ç†Šï¼š`+ '_` æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

Amosï¼šemï¼Œè¿­ä»£å™¨åªæœ‰åœ¨ `&self` è¢«å€Ÿç”¨çš„æƒ…å†µä¸‹ï¼Œæ‰æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ˜¯ä»å®ƒé‚£é‡Œè·å–çš„ï¼

é…·ç†Šï¼šå•Šï¼Œé‚£ä¹ˆ `impl Iterator<Item = T>` (æ²¡æœ‰ä»»ä½•é™„åŠ æ³¨é‡Š)çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¤šå°‘å‘¢ï¼Ÿ

Amosï¼šå°±åƒ `Box<T>` ä¸€æ ·ï¼Œå®ƒé»˜è®¤æ˜¯ `'static` çš„ï¼Œè¿™åªé€‚ç”¨äºæ‹¥æœ‰æ‰€æœ‰æƒçš„ç±»å‹ï¼ˆæ¯”å¦‚æˆ‘ä»¬çš„ `neighbor_positions` è¿­ä»£å™¨ï¼Œå®ƒæ‹¥æœ‰äº§ç”Ÿæ•°æ®é¡¹æ‰€éœ€çš„æ‰€æœ‰æƒï¼‰ï¼Œæˆ–è€…ï¼Œæˆ‘çŒœæµ‹ï¼ŒçœŸæ­£çš„ `'static` å¼•ç”¨ç±»ä¼¼äºä¸€ä¸ª `const`ï¼Œæˆ–è€…ä¸€äº›åœ¨ [`Box::leak`](https://doc.rust-lang.org/stable/std/boxed/struct.Box.html#method.leak) æˆ– `include_str` ä¸­â€œæ³„æ¼â€çš„ä¸œè¥¿ï¼

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹å®ç°ä¸€äº›â€œç»†èƒè‡ªåŠ¨æœºâ€é€»è¾‘äº†ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäº `Tile` åšä¸€äº›å¤„ç†ï¼š

```rust
impl Tile {
    fn next<I>(self, neighbors: I) -> Self
    where
        I: Iterator<Item = Self>,
    {
        match self {
            Self::Floor => Self::Floor,
            Self::EmptySeat => match neighbors
                .filter(|t| matches!(t, Self::OccupiedSeat))
                .count()
            {
                // no one around? we can sit here!
                0 => Self::OccupiedSeat,
                // social distancing please
                _ => Self::EmptySeat,
            },
            Self::OccupiedSeat => {
                match neighbors.filter(|t| matches!(t, Self::OccupiedSeat)).count() {
                    // up to 3 neighbors: still okay for now
                    0..=3 => Self::OccupiedSeat,
                    // that's too many folks!
                    _ => Self::EmptySeat,
                }
            }
        }
    }
}
```

çœ‹çœ‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä»€ä¹ˆ...å•Šï¼Œå¯¹äº†ï¼Œä¸º Map å®ç° trait â€”â€” ä½†æ˜¯åªæœ‰å½“ `T` æœ¬èº«å¯ `Debug` çš„æ—¶å€™ã€‚å“¦ï¼Œè¿˜æœ‰ `Copy`ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ `get`:

```rust
impl<T> fmt::Debug for Map<T>
where
    T: fmt::Debug + Copy,
{
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        for y in 0..self.size.y {
            for x in 0..self.size.x {
                write!(f, "{:?}", self.get(Vec2 { x, y }).unwrap())?;
            }
            writeln!(f)?;
        }
        Ok(())
    }
}
```

ç„¶å... ä½ çŸ¥é“æ€ä¹ˆåšä¼šæ›´å¥½å—ï¼Ÿç”±äºè¿™äº›è§„åˆ™åŒæ—¶é€‚ç”¨äºæ‰€æœ‰çš„ tileï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè¿­ä»£æ‰€æœ‰ tileï¼Œé‚£å°†æ˜¯éå¸¸ç®€æ´çš„ã€‚

```rust
impl<T> Map<T>
where
    T: Copy,
{
    fn iter(&self) -> impl Iterator<Item = T> + '_ {
        self.tiles.iter().copied()
    }
}
```

é…·ç†Šï¼šä½†æ˜¯... æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ä»–ä»¬çš„ä½ç½®ï¼Œå¯¹å§ï¼Ÿè¿™æ ·æˆ‘ä»¬å°±èƒ½æ¨æ–­å‡ºä»–ä»¬çš„é‚»è¿‘ä½ç½®åæ ‡äº†ï¼Ÿ

å¯¹! ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥å¦ä¸€ç§ç±»å‹: `Positioned`:

```rust
#[derive(Debug)]
struct Positioned<T>(Vec2, T);
```

å¹¶ä½¿ `iter` æ–¹æ³•è¿”å› `position<T>` ç±»å‹ï¼Œå¹¶å°†ç±»å‹ä½œä¸º Item çš„ç±»å‹:

```rust
impl<T> Map<T>
where
    T: Copy,
{
    // this replaces our previous `iter` method
    fn iter(&self) -> impl Iterator<Item = Positioned<T>> + '_ {
        (0..self.size.y)
            .map(move |y| {
                (0..self.size.x).map(move |x| {
                    let pos = Vec2 { x, y };
                    Positioned(pos, self.get(pos).unwrap())
                })
            })
            .flatten()
    }
}
```

æˆ‘ä»¬è¯•è¯•çœ‹ï¼š

```rust
fn main() {
    let mut m = Map::new(Vec2 { x: 3, y: 3 });
    m.set(Vec2 { x: 1, y: 1 }, Tile::OccupiedSeat);

    for tile in m.iter() {
        println!("{:?}", tile);
    }
}
```

```shell
$ cargo run --quiet
Positioned(Vec2 { x: 0, y: 0 }, .)
Positioned(Vec2 { x: 1, y: 0 }, .)
Positioned(Vec2 { x: 2, y: 0 }, .)
Positioned(Vec2 { x: 0, y: 1 }, .)
Positioned(Vec2 { x: 1, y: 1 }, #)
Positioned(Vec2 { x: 2, y: 1 }, .)
Positioned(Vec2 { x: 0, y: 2 }, .)
Positioned(Vec2 { x: 1, y: 2 }, .)
Positioned(Vec2 { x: 2, y: 2 }, .)
```

é…·ç†Šï¼šçœ‹èµ·æ¥ä¸é”™ï¼

ç„¶åï¼Œæœ€åï¼Œä½œä¸ºä¸€ä¸ªå¥–åŠ± â€”â€” æˆ‘ä»¬å¯ä»¥å°†å…¶æ”¶é›†åˆ° `Map` ä¸­ã€‚

é…·ç†Šï¼šè¿™æœ‰äº›ä¸åŒ! æˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Ÿ

æˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹ `Iterator::collect` çš„ç­¾åï¼š

```rust
fn collect<B>(self) -> B
where
    B: FromIterator<Self::Item>, 
```

æˆ‘ä»¬åªéœ€è¦å®ç° `FromIterator`ï¼

```rust
use std::iter::FromIterator;

impl<A> FromIterator<Positioned<A>> for Map<A> {
    fn from_iter<T: IntoIterator<Item = Positioned<A>>>(iter: T) -> Self {
        todo!()
    }
}
```

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„ `Map` æ„é€ å‡½æ•°éœ€è¦ç¡®å®š size:

```rust
fn new(size: Vec2) -> Self
```

æˆ‘ä»¬åªæ˜¯å¾—åˆ°å·²çŸ¥ä½ç½®çš„ tile æµ â€”â€” æˆ‘ä»¬ä¸çŸ¥é“æœ€åçš„åœ°å›¾æœ‰å¤šå¤§ï¼æ‰€ä»¥æˆ‘æƒ³æˆ‘ä»¬çš„é—®é¢˜ä¸å¤ªé€‚åˆ `collect`ã€‚

ä¹Ÿè®¸è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•/traitï¼Ÿä¸€ç§å¯ä»¥è®©æˆ‘ä»¬è·å–ç°æœ‰ Map çš„æ–¹æ³•ï¼Ÿ

é…·ç†Šï¼šæœ‰çš„ï¼Œçœ‹æˆ‘æ‰¾åˆ°äº†ä»€ä¹ˆ:

```rust
fn extend<T>(&mut self, iter: T)
where
    T: IntoIterator<Item = A>, 
```

å•Šï¼Œçœ‹èµ·æ¥æœ‰ç”¨ã€‚

```rust
use std::iter::Extend;

impl<A> Extend<Positioned<A>> for Map<A> {
    fn extend<T: IntoIterator<Item = Positioned<A>>>(&mut self, iter: T) {
        for Positioned(pos, tile) in iter {
            self.set(pos, tile)
        }
    }
}
```

å¤ªæ£’äº†ï¼

å¥½å§ï¼Œæˆ‘æƒ³ç°åœ¨æˆ‘ä»¬éœ€è¦è§£ææˆ‘ä»¬çš„åœ°å›¾ï¼š

```rust
impl Map<Tile> {
    fn parse(input: &[u8]) -> Self {
        let mut columns = 0;
        let mut rows = 1;
        for &c in input.iter() {
            if c == b'\n' {
                rows += 1;
                columns = 0;
            } else {
                columns += 1;
            }
        }

        let mut iter = input.iter().copied();
        let mut map = Self::new(Vec2 {
            x: columns,
            y: rows,
        });
        for row in 0..map.size.y {
            for col in 0..map.size.x {
                let tile = match iter.next() {
                    Some(b'.') => Tile::Floor,
                    Some(b'L') => Tile::EmptySeat,
                    Some(b'#') => Tile::OccupiedSeat,
                    c => panic!("Expected '.', 'L' or '#', but got: {:?}", c),
                };
                map.set(Vec2 { x: col, y: row }, tile);
            }
            iter.next();
        }
        map
    }
}
```

è®©æˆ‘ä»¬æ¥åšä¸€ä¸ªå¿«é€Ÿçš„æµ‹è¯•æ£€æŸ¥ï¼Œæˆ‘ä»¬çš„è¾“å…¥ä¾‹å­æ˜¯:

```text
L.LL.LL.LL
LLLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLLL
L.LLLLLL.L
L.LLLLL.LL
```

æˆ‘ä»¬çš„è§£æç‰ˆæœ¬æ˜¯:

```rust
fn main() {
    let m = Map::<Tile>::parse(include_bytes!("input.txt"));
    dbg!(&m.size);
    println!("{:?}", m);
}
```

```shell
$ cargo run --quiet
[src/main.rs:230] &m.size = Vec2 {
    x: 10,
    y: 10,
}
L.LL.LL.LL
LLLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLLL
L.LLLLLL.L
L.LLLLL.LL
```

çœ‹èµ·æ¥ä¸é”™ï¼

ç°åœ¨ï¼Œæˆ‘æƒ³æˆ‘ä»¬è¿˜éœ€è¦åœ¨ `Map` ä¸Šå®ç°ä¸€ä¸ª `next` æ–¹æ³•ï¼Œå¯¹å—ï¼Ÿä½†åªæœ‰å½“ `T = Tile`:

```rust
impl Map<Tile> {
    fn next(&self) -> Self {
        let mut res = Self::new(self.size);
        res.extend(
            self.iter()
                .map(|Positioned(pos, tile)| Positioned(pos, tile.next(self.neighbor_tiles(pos)))),
        );
        res
    }
}
```

é…·ç†Šï¼šè¿™çœŸæ˜¯å¤ªæ£’äº†ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„åŸºç¡€ä»£ç éƒ½æœ‰äº†å›æŠ¥ï¼

è®©æˆ‘ä»¬æ‰“å°ä¸€äº›ç¤ºä¾‹åœ°å›¾çš„è¿­ä»£:

```shell
$ cargo add itertools
      Adding itertools v0.9.0 to dependencies
```

```rust
fn main() {
    let maps = itertools::iterate(Map::<Tile>::parse(include_bytes!("input.txt")), Map::next);
    for map in maps.take(5) {
        println!("{:?}", map);
    }
}
```

ä½ çœŸçš„éœ€è¦æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½å˜æˆè¿­ä»£å™¨å—ï¼Ÿ

Amosï¼šç°åœ¨æ˜¯å¯’å‡ï¼Œç†Šï¼Œæˆ‘ä»¬è¿˜æœ‰æ—¶é—´ï¼

```shell
$ cargo run --quiet
L.LL.LL.LL
LLLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLLL
L.LLLLLL.L
L.LLLLL.LL

#.##.##.##
#######.##
#.#.#..#..
####.##.##
#.##.##.##
#.#####.##
..#.#.....
##########
#.######.#
#.#####.##

#.LL.L#.##
#LLLLLL.L#
L.L.L..L..
#LLL.LL.L#
#.LL.LL.LL
#.LLLL#.##
..L.L.....
#LLLLLLLL#
#.LLLLLL.L
#.#LLLL.##

#.##.L#.##
#L###LL.L#
L.#.#..#..
#L##.##.L#
#.##.LL.LL
#.###L#.##
..#.#.....
#L######L#
#.LL###L.L
#.#L###.##

#.#L.L#.##
#LLL#LL.L#
L.L.L..#..
#LLL.##.L#
#.LL.LL.LL
#.LL#L#.##
..L.L.....
#L#LLLL#L#
#.LLLLLL.L
#.#L#L#.##
```

ç°åœ¨å›ç­”é—®é¢˜ï¼š
> é€šè¿‡é‡å¤åº”ç”¨ä½ç½®è§„åˆ™æ¥æ¨¡æ‹Ÿä½ çš„ä½ç½®åŒºåŸŸï¼Œç›´åˆ°æ²¡æœ‰ä½ç½®æ”¹å˜çŠ¶æ€ã€‚æœ‰å¤šå°‘ä½ç½®è¢«å äº†ï¼Ÿ

é…·ç†Šï¼šå—¯ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å°†å½“å‰çš„çŠ¶æ€ä¸ä¹‹å‰çš„çŠ¶æ€å¯¹æ¯”... å¬èµ·æ¥åƒæ˜¯ [`tuple_windows`](https://docs.rs/itertools/0.9.0/itertools/trait.Itertools.html#method.tuple_windows) çš„å·¥ä½œï¼

Amosï¼šç¡®å®æ˜¯! æˆ‘ä¸æƒ³ä¸€ä¸ªä¸€ä¸ªåœ°æ¯”è¾ƒæ‰€æœ‰çš„ tile...

é…·ç†Šï¼šæˆ‘ä»¬å¯ä»¥åœ¨ Map ä¸Šæ´¾ç”Ÿ `PartialEq` traitï¼Ÿ

Amosï¼šè¿™ä¸»æ„ä¸é”™ï¼

```rust
#[derive(PartialEq)]
struct Map<T> {
    size: Vec2,
    tiles: Vec<T>,
}
```

>* é…·ç†Šçƒ­è¾£å°è´´å£«
> æ³¨æ„: `Vec2` å·²ç»æ´¾ç”Ÿäº† `PartialEq`ã€‚è‡³äº `T`ï¼Œå¯èƒ½æœ‰ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚`Map<T>` åˆ™åªæœ‰åœ¨ T æœ¬èº«å®ç° PartialEq æ—¶ï¼Œæ‰ä¼šå®ç° PartialEqã€‚

Amosï¼šæˆ‘ä»¬æ€ä¹ˆç¡®å®šè¿™äº›ï¼Ÿ

é…·ç†Šï¼šä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [cargo-expand](https://lib.rs/crates/cargo-expand) æ£€æŸ¥æ´¾ç”Ÿå®å±•å¼€çš„ç»“æœï¼

```rust
#[automatically_derived]
#[allow(unused_qualifications)]
impl<T: ::core::cmp::PartialEq> ::core::cmp::PartialEq for Map<T> {
    #[inline]
    fn eq(&self, other: &Map<T>) -> bool {
        match *other {
            Map {
                size: ref __self_1_0,
                tiles: ref __self_1_1,
            } => match *self {
                Map {
                    size: ref __self_0_0,
                    tiles: ref __self_0_1,
                } => (*__self_0_0) == (*__self_1_0) && (*__self_0_1) == (*__self_1_1),
            },
        }
    }
    #[inline]
    fn ne(&self, other: &Map<T>) -> bool {
        match *other {
            Map {
                size: ref __self_1_0,
                tiles: ref __self_1_1,
            } => match *self {
                Map {
                    size: ref __self_0_0,
                    tiles: ref __self_0_1,
                } => (*__self_0_0) != (*__self_1_0) || (*__self_0_1) != (*__self_1_1),
            },
        }
    }
}
```

Amosï¼šå•Š! çœ‹... ç”Ÿæˆäº†ã€‚è¿™æ˜¯åˆç†çš„ã€‚è€Œä¸”å®ƒä½¿ç”¨çš„æ˜¯ `core::` è€Œä¸æ˜¯ `std::` ä¸­çš„ç±»å‹ï¼Œæˆ‘æƒ³è¿™ä¹Ÿæ˜¯[æœ‰é“ç†](https://rust-embedded.github.io/book/intro/no-std.html)çš„ã€‚

ç»§ç»­ â€”â€” è®©æˆ‘ä»¬åœ¨ Map ä¸Šå®ç° `last` æ–¹æ³•ï¼Œå®ƒæ¨¡æ‹Ÿè¾¾åˆ°ä¸€ä¸ªæœ€ç»ˆçš„çš„çŠ¶æ€:

```rust
impl Map<Tile> {
    fn last(self) -> Self {
        use itertools::Itertools;
        itertools::iterate(self, Map::next)
            .tuple_windows()
            .find_map(|(prev, next)| if prev == next { Some(next) } else { None });

        todo!();
    }
}
```

é…·ç†Šï¼šå•Šå“¦ï¼Œè¿™ä¸ç®¡ç”¨:

```shell
$ cargo check --quiet
error[E0277]: the trait bound `Map<Tile>: Clone` is not satisfied
   --> src/main.rs:210:14
    |
210 |             .tuple_windows()
    |              ^^^^^^^^^^^^^ the trait `Clone` is not implemented for `Map<Tile>`

error[E0277]: the trait bound `Map<Tile>: Clone` is not satisfied
   --> src/main.rs:211:14
    |
211 |             .find_map(|(prev, next)| if prev == next { Some(next) } else { None });
    |              ^^^^^^^^ the trait `Clone` is not implemented for `Map<Tile>`
    |
    = note: required because of the requirements on the impl of `Iterator` for `TupleWindows<Iterate<Map<Tile>, for<'r> fn(&'r Map<Tile>) -> Map<Tile> {Map::<Tile>::next}>, (Map<Tile>, Map<Tile>)>`

error: aborting due to 2 previous errors
```

å™¢ï¼æˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨ `Map` ä¸Šæ´¾ç”Ÿ `Copy`ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦å…‹éš† `Map`ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æœ‰å¤ªå¤šçš„åˆ†é…å’Œæ‹·è´ã€‚

é…·ç†Šï¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ [im crate](https://lib.rs/crates/im) å—ï¼Ÿ

è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæœ‰å¤šå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸€ç§â€œä¸´æ—¶æ›¿ä»£å“â€:

```shell
$ cargo add im
      Adding im v15.0.0 to dependencies
```

```rust
use im::Vector;

#[derive(PartialEq)]
struct Map<T> {
    size: Vec2,
    tiles: Vector<T>,
}
```

æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼š

```shell
$ cargo check --quiet
error[E0369]: binary operation `==` cannot be applied to type `Vector<T>`
  --> src/main.rs:71:5
   |
71 |     tiles: Vector<T>,
   |     ^^^^^^^^^^^^^^^^
   |
   = note: this error originates in a derive macro (in Nightly builds, run with -Z macro-backtrace for more info)
help: consider further restricting this bound
   |
68 | #[derive(PartialEq + std::cmp::PartialEq)]
   |                    ^^^^^^^^^^^^^^^^^^^^^
```

è®©æˆ‘ä»¬çœ‹çœ‹ `im::Vector` æ˜¯å¦å®ç°äº† `PartialEq`ã€‚

```rust
impl<A: Clone + PartialEq> PartialEq<Vector<A>> for Vector<A>
```

ä½†å‰ææ˜¯ `A` å®ç°äº† `Clone` trait

å¥½å§ï¼Œ`Tile` ç»å¯¹å®ç°äº† `Clone`ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåš:

```rust
#[derive(PartialEq)]
struct Map<T>
where
    T: Clone,
{
    size: Vec2,
    tiles: Vector<T>,
}
```

ç°åœ¨æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªçº¦æŸæ·»åŠ åˆ°æˆ‘ä»¬çš„å…¶ä»– impl å—ä¸­ â€”â€” è¿™ç•™ç»™è¯»è€…ä½œä¸ºç»ƒä¹ ã€‚

>* é…·ç†Šçƒ­è¾£å°è´´å£«
> æ— è®ºåœ¨å“ªé‡Œï¼Œæˆ‘ä»¬æœ‰ `T: Copy` çš„çº¦æŸï¼Œæˆ‘ä»¬éƒ½ä¸éœ€è¦æ·»åŠ  `+Clone`ï¼Œå› ä¸ºå®ç°äº† `Copy` æ„å‘³ç€å®ç°äº† `Clone`ï¼š

```rust
pub trait Copy: Clone { }
```

ç°åœ¨æˆ‘ä»¬è¿˜å¯ä»¥åŸºäº `Map` æ´¾ç”Ÿ `Clone` trait:

```rust
#[derive(PartialEq, Clone)]
struct Map<T>
where
    T: Clone,
{
    size: Vec2,
    tiles: Vector<T>,
}
```

å®Œæˆæˆ‘ä»¬ `last` çš„æ–¹æ³•å®ç°:

```rust
impl Map<Tile> {
    fn last(self) -> Self {
        use itertools::Itertools;
        itertools::iterate(self, Map::next)
            .tuple_windows()
            .find_map(|(prev, next)| if prev == next { Some(next) } else { None })
            .unwrap()
    }
}
```

è®©æˆ‘ä»¬è¯•è¯•å§ï¼

```rust
fn main() {
    let last = Map::<Tile>::parse(include_bytes!("input.txt")).last();
    println!("{:?}", last);
}
```

```shell
$ cargo run --quiet
#.#L.L#.##
#LLL#LL.L#
L.#.L..#..
#L##.##.L#
#.#L.LL.LL
#.#L#L#.##
..L.L.....
#L#L##L#L#
#.LLLLLL.L
#.#L#L#.##
```

é…·ç†Šï¼šè€¶ï¼Œç»“æŸäº†! æ¥æ‹›ï¼Œ[ç»æ€é—®é¢˜](https://en.wikipedia.org/wiki/Halting_problem)ã€‚

è€Œä¸”ï¼Œæ—¢ç„¶æˆ‘ä»¬å¯¹è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ä»¥æ•°å­—çš„å½¢å¼å‡ºç°ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æ¥è®¡ç®—ä¸€ä¸‹æœ€ç»ˆæœ‰å¤šå°‘ä½ç½®è¢«å æ®:

```rust
fn main() {
    let last = Map::<Tile>::parse(include_bytes!("input.txt")).last();
    println!("{:?}", last);
    println!(
        "there are {} occupied seats",
        last.iter()
            //      ğŸ‘‡  this is a Positioned<Tile>
            .filter(|p| matches!(p.1, Tile::OccupiedSeat))
            .count()
    );
}
```

```shell
$ cargo run --quiet
#.#L.L#.##
#LLL#LL.L#
L.#.L..#..
#L##.##.L#
#.#L.LL.LL
#.#L#L#.##
..L.L.....
#L#L##L#L#
#.LLLLLL.L
#.#L#L#.##

there are 37 occupied seats
```

è¿™ä¸ªä¾‹å­å°±æ˜¯è¿™æ ·! æˆ‘ä»¬ç”¨é¢˜ç›®çš„è¾“å…¥æ¥è¯•è¯•ï¼š

```sehll
$ cargo run --quiet
#L#L#.#LL#L##L#.#LL##L##L#.#L#L#L#.#L#L#L#L#L#L#L#L#.#L#L#L#L#.#L##L#.#L#L#L#.#L#L#L#L#LL#L#L#L#L#
LLLLL.LL.L.LLLL.LLL..LLLLL.LLLLLL#LLLLLLLLLLLLLLLLLL.LLLLLLLLL.LLLLLL.LLLLLLL.LLLLLLL.LLLLLLLLLLLL
#L#L#.L#L#.#L#L#L#L#L#L#L#L#L#L.L..#L#L#L#L#L#L#L#L#L#L#L#L#L#.#L#L#L.L#L#L##L#L#L#L#.#.L#L#L#L#L#
LLLLLLLLLL.LLLL.LLLLLLLLLL.LLLL#L#.LLLLLLLLLLLLLLLLL.LLLLLLLLL.LLLLLL#LLLLLLLLLLLLLLL.LLLLLLLLLLLL
#L#L#L#L#L#L#L#.#L##.#L#L#.#L#LLLL.##.L#L#L#..#L#L#L#L#L#L#.L#.#L#L#L#.#L#L#L#L##L#L#.L#L#L#L#L#L#
LLLLLLLLLL.LLLL.LLLL.LLLLL.LLLL#L#LLLLLLLLLL.LLLLLLLLLLLLLLLLL.LLLLLL.LLLLLL.LLLLLLLLLLLLLLLLLLLLL
#L#L#L.L##.##L#.#L##.#L#L#L##LLLL#.#L#L#L#L#.#L#L#LL.#L##L#.##.#L##.#L#L#L#.#L#LL#L##.##L#L#L#L#LL
.LL..L#.L..L.L...LL..L..L.L...L#..L...LL..LLLL.#.L.#.....L....L.LL...L.LL.LL....#...L..L....L....#
#L#L#.LL##.#L#L#L#L#.#L#L#.#L#LLL#L#L#L#L#LLL#LLL#LLL#L#L#L#L#.#L#L#L.#L#L#L#.#LLL.#L#LLL#L#L#L#LL
#LLLLL#LLL.LL#L.L#LL.LLL.L.LLLL#L#L#L#L#L#L#LLL#LLL#.L.LLLLLLLLLL.LLLLLL#L#L#.#L#LL#L.L#LLLLL.LLL#
LL#LL.#LLL.LLLL.LLL#L#L#L#.#L#LLLLLLLLLLLLLLL#LLL#LL.#L#L#L#L#.#L#L#LLLLLLLLL...LLLLLLLLL#.#L#L#LL
#LLL#L.L#L#L#L#.#L#L.LLLL#L#L.L#L#.#L#L#L#L#..L#LL.#.LLLLLL#L#.#LLLLL#.L#L#L#.#L#LL#L#L#LLL.LLL.L#
L.#...#.....LLL.L..L#...#......L.LLL........L#..L#L..#.#L#....L..#.#.L..L..L.LL..L.......LL..L.#..
#LLL#.#L#L#L#L#L#LLL#L#LLL#L#LL#L#.#L#L#L#L#.LL#LLL#LLLLLLL#L#.#LLL.L#L#L#L#L###L#L#L#L#L#L#L#LLL#
LL#L#LLLL.LLLLL.LL#L.LLL#L.LLLLLLL.LLLLLLLLLL#LLL#LL.#L#L#LLLL.LL#L#L.LL.LLLL.LLLLLLLLLL.LLLLLL#LL
#LLL###L#L.L#L#.#LLL.#LLL.##LL#L#.##L#L#L#L#.#L#LLL#.LLLLLL#L#.#LLLLL.#L#L#.#.#L#L#L#.##L#L#L#L#L#
LL#LL.LLLL#LLLL.LLL#.LL#LL.LLLLL.LLLLLLLLLLL.#LLL#LL.#L#L#LLL#LLL##L#.LLLLLLL..LLLLLL.LLLL.LLLLLLL
#LLL#.#L#L.L#L#.#LLL.#LLL#L#L#.#L#L#L##L#L#L.L##LLL#.LLLL.L#L#.#LLLLLL#L#L#L#.#L#L#L#.#L##L#L#L#L#
..#..L.L........LL.#.#..##L........L....#L..#L#.L#....#.......LL.##L#....L...L.LL........#.L......
#LLL#.#.L#.#L#L#L#L#.LLLLL.#L#L#L#L#.#LLLLLL.LLLLLL#.LLLL#L#L#.#LLLLL.#L#L#L#LLL#L#L#.#.LLL#L#L#.#
LL#L#.LLLL.LLLL..LL#.#L#L#L#LLLLLL.#L#L#L#L#L#L#L#LL.#L#LLLL.LLLL##L#L#L#LLLLL#LLLLLL.LL##LLLLLLLL
.LLLLL##L#.#L##.#LLL..LLL#LLLLLLLL.#LLLLLLLL.LLLLLLL.LLLL#L#L#.#LLL.L.L..L#L#.LL#L#L#L#LLLL#L#L#L#
#L#L#.LLLL.LL#L.LL##.#L#LLL#.#L#L#LLL#L#L#L#.#L#L#L#.#L#L#LLLL.LL##L#.#L#L#LL.#LLL#L#L#LL#LL.#LLLL
.....L#.L.##...#..LL.LL..#...#..L.L#..LL..L.L..........#....#...#.L....L.L.L....#L.........#L..#L.
#L#L#.LLL#.LL#L.L#L#L#L#LLL#LLL#L#.LL#.#L#L#L#L#L#L#.#LLL#LLLL.##L#L#.#L#L#L#.#.#.#L#.#L#LLLL#LLL#
LLLLLL##LL.LLLL.LLLL.LLLL#.#L#L#LLL#LLLLLL.LLLL.LLLL.LL#LLL#.#LLLLLLL.LLL.LLL.LLLLLLL.LLLL##LLL#LL
#L#L#.LLL#.#L#L#L.L#.#L#LL.LLLLLL#.#L#L#L#L#L#L#L#L#.#L.L#LLL..##L#L#.#L#L#L#L#L#L#L#.#L#LLLL#L.L#
LLLLLL##.LLLLLL.L#LL.LLLL#.#L#L#LL.LLLLLL.LL.LLLLLLLLLLLLLL#.#..LLLLLLLLLLLLL.LLLLLLL.LLLL##LLLLLL
#L#L#.LLL#.#LL#.LLL#.#L#LL.LLLLLL#L#L#L#L#L#.#L#L###.#L#L#LLLL.L#L#L#.#L#.#L#L#L#L#L#.#L#LLLL#L#L#
L..L#.#.......L.#L..L.....#..#.#..L.L...L....LLL..........LL#.#L......L.L..L.LL..L....LL..#.......
#L#LL.LLL#.#LL#.LLLLL#L#LL.LLLLLL#.LL#L#L#L#.#L#L#L#.#L#LLLLLLLLL#L#LL#L#L#L#.L#L#L#L#L#LLLLL#L#L#
#LLL#.##.L.LLL..#L#L.LL#L#.#L#L#LL.#LLLLLLLL.LLLLLLL.LLLL#L#L#.#LLLLL.LLLLLLLLLLLLLLL.LLL#L#LLLLL.
LL#LL.LLL#.#LL#.LLLL.#LLLL.LLLLLL#LLL#L#L#L#.#L#L#L#.#L#LLLLL#.LL#L##.#L#L#L#.#L#L#L#.#.LLLLL#L#L#
#LLL#.##LL.LLLL.#L##.LL#L#.#L#L#LL.#LLLLLLLL.LLLLLLLLLLLL#L#LL.#LL.LL.#LLLLLL.#LLLLLLLLLL#L#LLLLLL
LL#LL.LLL#.#.L#.LLLLL#LLLL.LLLLLL#.LL#L#L#L#.#L#L#L#.#L#LLLLL#.LL#L##.#L#L#L#.LLL#L#L.L#LLLLL#L#L#
#LLL#.##L#.#LLL.#L#..LL#L#.#L#L#L..#LLL#LLLL.LLLLLL#.LLLL#L#L#.#LLLLL.L.LLLLL.#LLLLLL#LLL#L#LLLLLL
LL#LLLLLLL.LL##.LLLL#LLLLL.LLLL.L..LL#LLL#L#.#L#L#LL.#L#LLL.LLLLL#L#L##L#L#L#.LLL#L#L.L#LLLLL#L#L#
#LLL#.##L#.#LLL.#L#L.L#L#L#L#L#L##.#L.L#L#LL.L.LLLL#.LLLL#L#L#L#LLL#..LLLLLLL.L#LLLLL#L#L#L#L#LLLL
...L#LLL..L...#..L..L.............L..#...#..#.#.#..LL#.#.....L.L.#.#.#..#.L#.#..L.#..#LL..LL...#L#
#L#LL.L#L#.#LLL.##L#.#L#L#.#L#.#L#.#LLL#LLLL.LL.LL##.LLLL.L#L#L#LLLLL.LLLLLL..LL#LLLL.L#L#L#L#LLLL
LLLL#LLLLL.L.##.LLLLLL.LLL.LLLLLLL.LL#LLL#L#.#L#LLL#L#L#L#LLL..L.#L#L.LL#L.L#.#LLL#L#.LLLLLLLLL#L#
.#LLLL##L#.#LLL.#L##.##L#L.L#.##L#.#LLL#LLLL.LLLL#LL.#L#L#L###L#LLLLL#LLLL#LL.LL#LLLL.##.#L#L#LLLL
LLL##.LLLL.LLL#.LLLL.LLLLL#LL.LLLL.LL#LLL#L#.#L#LLL#.LLLLLLLLL.LL#L#L.L##LLL#L#LLL#L#.LLLLLLLLL#L#
#LLL..#L#L#L#LL.#L##.#L.L#..##L#L#.#LLL#LL.L.LLLL#L#.#L#.#L#L#.#LLL#L#L#.L#L#LLL#L#LL.##L#.#L#LLLL
LL#L#L.LLL.LLL#.LLLL.LL#LL.#LL...LLLL#LLL#L#L#L#LLLLLLLLLLLLLLLLL#LLL.LLLLLLL.#LLLLL#.LLLLLLLLL#L#
#LLL#.#L#L.L#LL.#L##.#L#L#.LL#L#L#.#LLL#LLLL.LLLL#L#.#L#L#L#L#L#LLLL#.#L#L#L#.LL#L#LL.##.#L#.#LLLL
LL#LLLLLLL#LLL#LL.LL.LLLLL.#LLLLLL.LL#LLLLL#L#L#LLLLLLLLLLLLLLLLL##LLLLLLLLLL.#LLLLL#.LLLLLLLLL#L#
#LLLL##L#L..#LL.#L##.#L#L#.#L#L#L#.#L.L#L#L#L.L#L#L#.#L#L#L#L#.#LLLL#L#L#L#L#.LL#L#LL.L#L#L#L#LLLL
.L#..L....#..L#....L.......#........L#......L...L..............L.#...L.L....LL#L.....#......LLL..#
#L#L#.#L#L.L#LL.#L##.#L#L#L#L#L#L#.#LLL#L#L#.#L#L###L#L#L.L#L..#L#L####LLL#L#.LLL#L#L#L#L#L#L#L#LL
LLLLL.#LLL#LLL#.LLLLLLLLLL.LL.LLLL.LL#LLLLLLLLLLLLLL.LLLL#LLL#.LLLLLL.LL#.LLLL#LLLLLL.LLLLLLLLLLL#
#L#L#.LL#L.L#LLL#L#L#L##L#.#L#L#L#.#L.L#L#L#.#L#L#L.L#L#LLL#LL.L#L#L#.#LLL#L#.LL#L#L#.##L##L#.L#L#
LLLLL.#LLL.LLL#.LLLLLLLLLL.#LLLLLL.LLLLLLLLLLLLLLLL#LLLLL#LLLL#LLLLLL.LL#LLLL.#LLLLLL.LLLLLLLLLLLL
#L#L#.LLL##L#LL.#L#L.#L#L#.##L#L#..#L#L#L#L#.#L#L#LLL#L#LLL##L.L#L#L#L#LLL#L#.LL##L#L##L#L#.L#L#L#
...L.L.#.#LL..#......LLL.L..L......L...LLL....L....#..LL.#.L..#..L......#.....#L.L.....L........L.
#L.L#LLL.L.#LLL.L#L#.#L#L#.#L#.#L#.#L#L#L#L#.#L#L#L#.#L#LLL##..L#L#L#.#L#L#L#.LLLL#L#.L.L#L#L#L#L#
LL#LL.##L#.LL#L#LLLLL#LLLL.LLLLLLL.L.LLLLLL..LLLLLLL.LLLL#LLLL.LLLLLL.LL#LLLL.#L#L#LLL##LLLLLLL#LL
#LLL#.LLL..#LLLLL#L#.L.#L#.#L#L#L#.#L#L#L#L#.#L#L#L#L#L#LLLLL#.##L#L#.#LLL#L#LLLLLLLL.LLL#L#L#LLL#
LL#L#.#L#..#L#L#LLLLL#LLLLLLLLLLLL.LLLLLLLLLLLLL.LL..LLLL#L#.L.LLL.LL.LL#LL.LL#L#L##L#L#LLLLLLL#LL
LLLLL.LLLL.LLLLLL#L#.LL#L#.#L#L#L#.#L#L#L#L#.#L#L#L#.#L#LL.LLL#L#L#L#.#LLL#L#.LLLLLLL.L.L#L#L#LLL#
#L#L#L#L#L#L#L#.LLLL.#LLLL.LLLLLLL.LLLLLLLLLLLLLLLLL.#LLLL#L#L.LLLLLLLLL#LLLL.#L#L#L#.L#LLLLLL.#L.
LLLLL.LLLL.LLLL.L#L#.LL#L#L#L#L#L##L#L#L#L#L#L#L#L#L.LLL##LLLL.##L#L#L#LLL#L#.LLLLLLLLL.L#L#L#L.L#
#L##L#.#L#L#L#L#LLL#.#LLLLLLLLLLL..LLLLL#LLL.LLLLL#L#L#LLLL#L#.LLLLL#.LL#L#L#L#L#L#L#.##LLLLLLLLLL
...L...L...L...#L...LL.#.#..##..#....##...#L#L.#........#......#..#....L.L....L...L.L.L.#L#.#..#.#
#L#L#.#.L#.LL#L.L#L#.#LLLLLLLLLLLLL#L.LL#LLL.LLLL.L#.#L.LLL#L#.LLLLL#.#L#L#L#L#L#L#L#.#LLLLLLLLLLL
LLLL#.LLLL.#L#L.L#LLLLL#L#L#L#L#L#LLL#LLL.L#.#L#L#L#L#L#L#L#L##L#L#LL.LLLLLLLLL.LLLLL.LLL#L#L#L#L#
#L#LL.L#L#.LLLL#L#L#.#LLLL.LLLL.LL.#LLL#L#LL.LLLLLLL.LLLLLLLLLLLLLLL#.#L#L#L#.#L#L#LL#L#LLLLLLLLLL
LLLLL#LLLL.#L#L.LLLL.LL#L#.#L#L#L#.LL#LLLLL#.#L#L#L#L#L#L#L#L#.#L#LLLLLLLLLLL.LLLLLLLLLLL#.#L#L#L#
#L#LL.LL#L.LLLL.LL##L#LLLLLLLL.LLL.#LLL#L#LL.LLLLLLL.LLLLLLLLL.LLLL#L#L#L#L#L.L#L####.L#LLLLLLLLLL
LLLL#.#LLL#L#L#.#LLLLLL#L#L#L#L#L#LLL#LLLLL#.###L#L#.#L#L#L#L#.#L#LL.LLLLLLLL#LLLLLLL.LLL#L#L#.#L#
#L#LL.LL#LLLLLLLLL#L#LLLL#LLLLLLLL.#LLLLLLLLLLLLLLLLLL.LLLLLLL.L.LL#L#L#L#L#LLLLLL#L#L#LLLLLLLLLLL
LL#L#.#LLL#L#L#.#L.L.L#LLLL#L#L#L#.LL##L#L##L#L#L#L#L#L#L#L#L#L#L#LLL.LLLLLLL.#L#LLL..#L##L#L#L#L#
#L.L...L#..LL..L..#.L....#...L..L..#L......#L.L.......L..LL........L#.#L#L#.......#.....LL.#L.....
LL#LL.LLLLLL#.#.#LLL.#L#LL.#L#L#L#.LL#L#L#LLLLL#L#L#.#L#L#LLL..LL#LLL.LLLLLL#L#L#L.L#.#L##LLLLL#L#
#L#L#.#L#L#L#.L.LL##.#LLL#.LLLLLLL.#LLLLLLL#.#LLLLLL.LL#LLL#L##LL#L###L#L#L##.#L#L#LL.LLLLL#L#LLLL
LLLLL.LLLL.LLL#L#LLLL.L#LL.L.#L#L#.LL#L#L#LL.LL#L#L#.#LL.#LLLL.LLLLLL.LLLLLLLLLLLL#L#.#L##LLLLL#L#
#L#.#.#L#L#L#L#.#L#L##LLL#L#LLLLLL.#LLLLL.L#.#L#LLLL.LL#LLL#L#.##L#L#.#L#L#L#.#L#LLLL.LLLLL#L#.#LL
..#.#....LL.LL.....L.LL......#.#L..LLL#L#......LL.L.#L.LL#...LLLL......L.L.L...LL..#..#..#...LL..#
#L#L#.#L#L#L#LL.#L#..#LLL#.#LLLLL#.#LLLLLLL#.#L#L#L#..#LLLL###.#LLL#L###.##L#.#L##LLL.LLLLL#L#.#L#
LL#L..LLLL.LLL#.LLLL.LL#LL.LL#L#LLLLL#L#L#LLLLLLLLLL.LLLL#LLLL.LL#LLL.LLLLLLL.LLLLL#L##L##LLLLL#LL
#L#.#.#L##.#LLL.L#L#.#LLL#.#LLLLL#.#LLLLLLL#L#L#L#.#.#L#LLLL#L#LLLLLL.#L#L#L#.#L##LLL.LLLLL#L#L.L#
L.#L..LLLL.L.#L#L#LLLLL#LL.LL#L#LL.LL#L#L#L..LLL.LLL.LLLL#L.LL.L#L#L#.LLLLLLLLLLLLLL#.#L##LLLLLLLL
#L#L#.#LL#.#L.L.LLLL.#LLL#.#LLLLL#LLLLLLLLL#L#L#L#L#.#L#L.L#L#LLLLLL..#L#L#L#.#L#L#LL.LLLLL#L#L#L#
L....L...L..L.#...#....#......#..#L#..#..#L.LL.L.L....L..#.#.LL#.#.L#LL.........L..L#.#L#......L..
#L#L#.##L#.#LLL.#LLL.#L#L#.#LLLLLL.LLLLLL#L#L#L#L#L#.#L#L#.LL#LLLLLLLL#L#L#L#.#L#LLLL.LLLLL#L#L#.#
LL#LL.LLL..LLL#.LLL#.LLLLL.LL#L#L#.#L#L#L#L#L.LLLL.LLLLLL#L#LLLL#L#L#.LLLLLLL.LL#L#L#.#LL#LLLLL.LL
LLLL#.#LL#LL.LL.LLLL.#L#L#.#LLLLLL.L.LLLLLLL.LLLLL#L#LLLLLLLLL#LLLLLLL#L#L#L#L#LLLLLL.LLLLL#L#L#L#
#L#LL.LLL#.#L###L#L#.#L#LL.LL#L#L#.#L#LL#L#.#L#L#L#L.L#L#L#L#L.L#L#L#.#L.L#L#L#L#L#L#.#LL#L#L#L#L#
LLLLL.LLLL.LLLL.LLLL.LLLLL.LLLLLLL.LLLLLLLLLLLLLLLLL.LLLLLLLLL.LLLLLL.LLLLLLL.LLLLLLLLLLLLLLLLLLLL
#L#L#LL#L#L#.#L#L#L#.#L##L#.#L#L#L#L#L##L#L#.#L#L#.#L#L#L#L#L#.#L#L#L##L#L#L#.#L#L#L#.#LL#L#L#L#L#

there are 2289 occupied seats
```

å°±è¿™æ ·å§ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥ä¸‹ä¸€éƒ¨åˆ†ã€‚

## ç¬¬äºŒéƒ¨åˆ†

è¿™æ˜¯ä¸€ä¸ªæ–°çš„éƒ¨åˆ†ï¼Œè§„åˆ™ï¼Œä»–ä»¬æœ‰äº›æ”¹å˜ã€‚

ç°åœ¨æˆ‘ä»¬è¦æ‰¾çš„åº§ä½å¯èƒ½ä¸æ˜¯ç›¸é‚»çš„ï¼Œä½†æ˜¯åœ¨ 8 ä¸ªæ–¹ä½ä¸­çš„ä¸€ä¸ªã€‚

ä¹‹å‰ï¼Œæˆ‘ä»¬çœ‹è¿‡è¿™äº›ï¼Œæˆ‘ä»¬åªçœ‹åˆ°ä¸¤ä¸ªæœ‰äººçš„åº§ä½:

![](https://fasterthanli.me/content/series/advent-of-code-2020/part-11/assets/neighbors.6bf6e50f123b3136.svg)

ä½†æ˜¯ç°åœ¨ï¼Œæˆ‘ä»¬æœæ¯ä¸ªæ–¹å‘è¿›ä¸€æ­¥è§‚å¯Ÿï¼Œç›´åˆ°æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªåº§ä½ â€”â€” æˆ‘ä»¬çœ‹åˆ° 8 ä¸ªæœ‰äººåçš„åº§ä½:

![](https://fasterthanli.me/content/series/advent-of-code-2020/part-11/assets/neighbors-far.0f1b60007cbead94.svg)

æ˜¯æ—¶å€™ä½¿ç”¨ä¸€ä¸ªæ–°æ–¹æ³•äº†! `visible_seats` å®Œå…¨å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚

```rust
impl Map<Tile> {
    fn visible_seats(&self, pos: Vec2) -> impl Iterator<Item = Tile> + '_ {
        use itertools::Itertools;
        (-1..=1)
            .map(|dx| (-1..=1).map(move |dy| (dx, dy)))
            .flatten()
            .filter(|&(dx, dy)| !(dx == 0 && dy == 0))
            // for each direction...
            .map(move |(dx, dy)| {
                // keep moving in set direction
                itertools::iterate(pos, move |v| Vec2 {
                    x: v.x + dx,
                    y: v.y + dy,
                })
                // as long as we're on the map
                .map(move |pos| self.index(pos))
                .while_some()
                // and until we reach a seat
                .filter_map(move |index| match self.tiles[index] {
                    Tile::Floor => None,
                    seat => Some(seat),
                })
                .take(1)
            })
            .flatten()
    }
}
```

é…·ç†Šï¼šå¥½å§ï¼Œé‚£ä¸ªè‚¯å®šéœ€è¦æµ‹è¯•ä¸€ä¸‹ã€‚

Amosï¼šå¥½å§ï¼Œé‚£ä¸ªè‚¯å®šéœ€è¦æµ‹è¯•ä¸€ä¸‹ã€‚

ç°åœ¨æ˜¯ä½¿ç”¨ [`indoc` crate](https://lib.rs/crates/indoc) çš„å¥½æ—¶æœºï¼

```rust
$ cargo add indoc
      Adding indoc v1.0.3 to dependencies
```

```rust
#[test]
fn test_visible_seats() {
    let map = Map::<Tile>::parse(
        indoc::indoc!(
            "
            .......#.
            ...#.....
            .#.......
            .........
            ..#L....#
            ....#....
            .........
            #........
            ...#.....
            "
        )
        .trim()
        .as_bytes(),
    );
    println!("{:?}", map);
    assert_eq!(map.visible_seats(Vec2 { x: 3, y: 4 }).count(), 8);
    assert_eq!(map.visible_seats(Vec2 { x: 8, y: 0 }).count(), 2);
}
```

```shell
$ cargo t -q

running 2 tests
..
test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
```

çœ‹èµ·æ¥ä¸é”™ï¼

è¿˜æœ‰ç¬¬äºŒä¸ªæµ‹è¯•:

```rust
#[test]
fn test_visible_seats2() {
    let map = Map::<Tile>::parse(
        indoc::indoc!(
            "
            .##.##.
            #.#.#.#
            ##...##
            ...L...
            ##...##
            #.#.#.#
            .##.##.
            "
        )
        .trim()
        .as_bytes(),
    );

    assert_eq!(map.visible_seats(Vec2 { x: 3, y: 3 }).count(), 0);
}
```

```shell
$ cargo t -q

running 3 tests
.F.
failures:

---- test_visible_seats2 stdout ----
.##.##.
#.#.#.#
##...##
...L...
##...##
#.#.#.#
.##.##.

thread 'test_visible_seats2' panicked at 'assertion failed: `(left == right)`
  left: `8`,
 right: `0`', src/main.rs:224:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    test_visible_seats2

test result: FAILED. 2 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out
```

é…·ç†Šï¼šçœ‹èµ·æ¥å¾ˆç³Ÿç³•ï¼

é‚£ä¹ˆï¼Œè¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ? è®©æˆ‘ä»¬è¯•ç€æ‰¾å‡ºå®ƒçœ‹åˆ°äº†å“ªäº› tile:

```rust
// in our test
dbg!(map.visible_seats(Vec2 { x: 3, y: 3 }).collect::<Vec<_>>());
assert_eq!(map.visible_seats(Vec2 { x: 3, y: 3 }).count(), 0);
```

```shell
$ cargo t -q seats2

running 1 test
F
failures:

---- test_visible_seats2 stdout ----
.##.##.
#.#.#.#
##...##
...L...
##...##
#.#.#.#
.##.##.

[src/main.rs:224] map.visible_seats(Vec2{x: 3, y: 3,}).collect::<Vec<_>>() = [
    L,
    L,
    L,
    L,
    L,
    L,
    L,
    L,
]
thread 'test_visible_seats2' panicked at 'assertion failed: `(left == right)`
  left: `8`,
 right: `0`', src/main.rs:225:5
```

é…·ç†Šï¼šå“¦ï¼Œå®ƒè‡ªå·±çœ‹åˆ°äº†! å› ä¸ºæˆ‘ä»¬æ˜¯ä» `pos` å¼€å§‹çš„ï¼Œè€Œä¸æ˜¯ `pos + (dx, dy)`ã€‚

Amosï¼šæ˜¯çš„ï¼Œçœ‹èµ·æ¥æˆ‘ä»¬åœ¨è°ƒç”¨ `itertools::iterate` æ—¶æŠŠåˆå§‹å€¼æé”™äº†ã€‚

é…·ç†Šï¼šæˆ–è€…æˆ‘ä»¬å¯ä»¥è·³è¿‡è¿™ä¸ªï¼Ÿ

Amosï¼šæˆ‘ä¹Ÿè¿™æ ·è§‰å¾—ã€‚

```rust
// keep moving in set direction
itertools::iterate(pos, move |v| Vec2 {
    x: v.x + dx,
    y: v.y + dy,
})
// ğŸ‘‡ new!
.skip(1)
```

ç°åœ¨æˆ‘ä»¬æ‰€æœ‰çš„æµ‹è¯•éƒ½é€šè¿‡äº†:

```shell
$ cargo t -q

running 3 tests
...
test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
```

è®©æˆ‘ä»¬è°ƒæ•´ç¬¬äºŒéƒ¨åˆ†é—®é¢˜ä¸­æŒ‡å®šçš„ `Tile::next` æ–¹æ³•:

> ç°åœ¨éœ€è¦ 5 ä¸ªæˆ–æ›´å¤šå¯è§çš„æœ‰äººåçš„åº§ä½æ‰èƒ½ä½¿ä¸€ä¸ªæœ‰äººåçš„åº§ä½å˜æˆç©ºçš„(è€Œä¸æ˜¯ä»¥å‰è§„åˆ™ä¸­çš„4ä¸ªæˆ–æ›´å¤š)

```rust
Self::OccupiedSeat => { match neighbors
        .filter(|t| matches!(t, Self::OccupiedSeat))
        .count()
    {
        // ğŸ‘‡ new!
        // up to 4 neighbors: still okay for now
        0..=4 => Self::OccupiedSeat,
        // that's too many folks!
        _ => Self::EmptySeat,
    }
}
```

ç„¶åæ›´æ”¹ `Map::<Tile>::next` ä½¿ç”¨ `visible_seats` è€Œä¸æ˜¯ `neighbor_tiles`ï¼š

```rust
impl Map<Tile> {
    fn next(&self) -> Self {
        let mut res = Self::new(self.size);
        res.extend(
            self.iter()
                //                                                          ğŸ‘‡ğŸ‘‡ğŸ‘‡
                .map(|Positioned(pos, tile)| Positioned(pos, tile.next(self.visible_seats(pos)))),
        );
        res
    }
}
```

æˆ‘ä»¬åº”è¯¥å¯ä»¥å‡ºå‘äº†ï¼

è¿™ä¸ªç¨‹åºçš„è°ƒè¯•æ„å»ºéœ€è¦ä¸€ç‚¹æ—¶é—´:

```shell
$ cargo build --quiet
    Finished dev [unoptimized + debuginfo] target(s) in 0.01s
$ time ./target/debug/day11 > /dev/null
./target/debug/day11 > /dev/null  5.68s user 0.00s system 99% cpu 5.680 total
```

è®©æˆ‘ä»¬çœ‹çœ‹ release æ„å»ºçš„ç‰ˆæœ¬æ‰§è¡Œæƒ…å†µ:

```shell
$ cargo build --release
    Finished release [optimized] target(s) in 0.01s
$ time ./target/release/day11 > /dev/null 
./target/release/day11 > /dev/null  0.24s user 0.00s system 99% cpu 0.240 total
```

å¥½å¤šäº†ï¼

>* é…·ç†Šçƒ­è¾£å°è´´å£«
> å¦‚æœæ‚¨çš„ Rust ç¨‹åºåœ¨ crate è¿è¡Œæ—¶æ¯”è¾ƒæ…¢ï¼Œä¸è¦å¿˜è®°ä½¿ç”¨ `--release` æ ‡å¿—æ¥å¯ç”¨ä¼˜åŒ–è¿è¡Œé€Ÿåº¦ï¼

ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ€ç»ˆç­”æ¡ˆ:

```shell
$ cargo run --release
    Finished release [optimized] target(s) in 0.01s
     Running `target/release/day11`
#L#L#.L#L#L#L#L.#L#L#L#L#L.#L#L#L#.L#L#L#L#L#L#L#LL#.L#L#L#L#L.#L#L#L.#L#L#L#.L#L#L#L#L#L#L#L#L#L#
LLLLL.#L.L.LLLL.LLL..LLLLL.LLLLLLLLLLLLLLLLLLLLLLLLL.LLLLLLLL#.LLLLL#.LLLLLLL.LLLLLLL.LLLLLLLLLLLL
#L#L#.LL#L.L#LL#L#L#L#L#LL#L#L#.L..#L#L#L#L#L#L#L##L#LL#L#L#LL.##L#LL.##L#L#L#L#L#L#L.#.L#L#L#L#L#
LLLLLL#LLL.LLLL.LLLLLLLLLL.LLLLL#L.LLLLLLLLLLLLLLLLL.LLLLLLLL#.LLLLL#LLLLLLLLLLLLLLL#.L#LLLLLLLLLL
#L#L#LLL#L#L#L#.L#L#.LL#L#.L#L#LLL.#L.#L#L#L..#L#LL#L#L#L#L.LL.##L#LLL.L#L#L#L#L#L#LL.LLL#L#L#L#L#
LLLLLL#LLL.LLLL.#LLL.#LLL#.LLLLL#L#LLLLLLLLL.LLLLLLLLLLLLLL#L#.LLLLL#.LLLLLL.LLLLLLL#LL#LLLLLLLLLL
#L#L#L.L#L.#L##.LLL#.LL##LLL##L#LL.L#L#L#L#L.#L#L##L.#L#L#L.LL.##L#.LLL#L#L.L#L#L##LL.LLL#L#L#L#L#
.LL..LL.L..L.L...#L..#..L.#...LL..L...LL..LLLL.L.L.#.....L....L.LL...#.LL.L#....L...#..L....L....L
LL#LL.L#L#.L#LLLLLLL.LLL#L.LLLL#LLL#L#L#L#L#L#LL#LLL#L#LL#LLL#.LLLL#L.L#LLLL#.LLLL.LLL#L#L#L#L#LL#
#LLL#LLLLL.L#L#.L#L#.LL#.L.L#L#LL#LLLLLLLLLLLLLLLL#L.L.LLLL#LLLL#.LLLLLLL#LLL.L#L#LL#.LLLLLL#.LLLL
LL#LL.##L#.LLLL.#LLLL#LLL#.LLLLLLLL#L#L#L#L#L#L##LLL.#L#L#LLL#.LL#L#LLL#LLL#L...LLLLLLL#L#.LL#L#L#
#LLL#L.LL#L#L##.LL#L.LL#L#L#L.L#L#.LLLLLLLLL..LLLL.#.LLLLLL#LL.#LLLLL#.LL#LLL.#LL#L#L#LLLL#.LLL.LL
L.#...L.....LLL.#..L#...L......L.LL#........LL..##L..#.L#L....L..L.#.L..L..L.L#..L.......LL..#.L..
#LLLL.L#LL#L#L#LLLL#LLLL#L#L#L#L#L.LL#L#L#L#.L#LLLL#LLLLLL#LL#.LL#L.LL#L#L#L#LLL#L#L#L#LL#L#L#L#L#
LL#L#LLLL.LLLLL.##LL.#L#LL.LLLLLLL.#LLLLLLLLL#LL##LL.L#L#LL#LL.#LLLL#.LL.LLLL.#LLLLLLLL#.LLLLLLLLL
#LLLLL#LL#.L#L#.LLL#.LLLL.L#L#L#L.LLL#L#L#L#.LL#LLL#.LLLL#LLL#.L#L#LL.#LLLL.#.LL#L#L#.LL#LL#L#L#L#
LL#L#.LLLLLLLLL.##LL.#L#L#.LLLLL.#L#LLLLLLLL.#LLL#LL.L#LLLL#LL#LLLLL#.LL#L#LL..LLLLLL.#LL#.LLLLLLL
#LLLL.#L#L.#L##.LLL#.LLLLLL#L#.L#LLLL#L#L#L#.LLL##L#.LLL#.LL#L.L#L#LLL#LLL#L#.L#L##L#.L#LLL#L#L#L#
..L..#.L........##.L.#..L#L........#....LL..#L#.L#....L.......LL.L#L#....L...L.#L........#.L......
L#L#L.L.L#.L#LLLLLL#.LL#LL.L#L#LL#LL.L#L#L#L.LLL#L#L.#L#L#L#LL.#LLLLL.L#L#L#LLLLLLLLL.#.LL#L#L#L.L
#LLLL.#LLL.L#L#..LLL.#LLL##LLLLLLL.##LLLLL#LL#LLLLL#.LLLLLLL.#LLL#L#L#LLLLLLL#L#L#L#L.LL#LLLLLL#L#
.LL#LLLL##.LLLL.#L#L..L#LLLL#L#L#L.LLL#L#LLL.LL#L#LL.L#L#L#LLL.LLLL.L.L..L#L#.LLLLLLL##LL#L#L#LLLL
L#L#L.#L#L.##L#.LL#L.LLLL#LL.LLL#L#L#LLLLLLL.#LLLLL#.LLLLLLL#L.L#L#LL.#L#LLLL.L#L#L#LLLLLLLL.LL#L#
.....L#.L.#L...#..LL.#L..L...#..L.LL..#L..#.L..........#....L...L.L....L.L.#....LL.........L#..LL.
#L#L#.LLL#.LLLL.L#L#LLL#L##LLLL#L#.LLL.L#LLLLL#L#L#L.#L#L#LL#L.#L#L#L.L#L#L#L.#.L.#L#.#L#L#LLLL#LL
LLLLLLL#L#.L#L#.LLLL.#LLLL.L#LLLLLLLL#LLLL.#L#L.LLL#.LLLLLLL.LLLLLLL#.LLL.LLL.#LLLLLL.LLLLL#L#LLL#
#L#L#.LLLL.LLL#L#.L#.LL#L#.LLL#L#L.#L#L#L#LLLLL#L#LL.##.L#L#L..L#L#LL.#L#LL#LLLL##L#L.L#L#LLLLL.LL
LLLLLL##.LLL#LL.#L#L.#LLLL.##LLLLL.LLLLLL.L#.LLLLLL#LLLLLLLL.#..LLLL#LLLLLLLL.#LLLLLL.LLLLL#L#L#L#
#L#L#.LLL#.LLL#.LLLL.LL#L#.LLL#L#L#L##L#LL#L.#L#L#LL.L#L#L#LLL.L#L#LL.##L.#L#LLL#L#L#.L#L#LLLLLLLL
L..LL.#.......L.#L..#.....L..L.L..L.L...L....LLL..........LL#.LL......L.#..L.L#..L....LL..L.......
#LL##.LL#L.LL##.LLLLLL#L#L.#L#L#L#.#LLLLL#L#.L#L#L#L.#L#L#LLL#L#L#L#L##LL#L#L.LLL#L#LL#L#LL#L#L#L#
LL#LL.#L.L.#LL..#L#L.LLLLL.LLLLLLL.LL#L#LLL#.LLL#LLL.#L#L#L#L#.LLLLLL.LLLLLLL#L#LLLL#.LLL#LLLLLLL.
#LLL#.LLL#.LLLL.LLLL.#L#L#.LL#L#LL#L#LLLL#LL.L#LLL#L.LLLLLLLLL.#L#L#L.##L#L#L.LLLL#LL.#.LLL#L#L#LL
LL#LL.##LL.#LL#.L#L#.LLLLL.#LLLLLL.LLL#L#LL#.LLL#LLL##L#L#L#L#.LLL.L#.LLLLLLL.#L#LLL#LL#L#LLLLLLL#
#LLL#.LLL#.L.L#.LLLLL#L#L#.LL#L#L#.L#LLLLLLL.#L#LL#L.LLLLLLLLL.L#L#LL.#LL#L##.LLLL#LL.LLLLL#L#L#LL
LL#LL.##LL.##L#.L#L..LLLLL.#LLLLL..#LLL#L#L#.LLLLLLL.#L#L#L#L#.LLLLL#.L.LLLLL.#L#LL#L#L#L#LLLLLLL#
#LLL#LLLL#.LLLL.LLL#L#L#L#.LL#L.#..LL#LLLLLL.#L#L#L#.LLLLLL.LL#L#L#LLL##L#L##.LLLLLLL.LLLLL#L#L#LL
LLL#L.##LL.##L#.L#LL.LLLLLL#L#L#LL.#L.L#L#L#.L.LLLLL.#L##L#L#LLLLLLL..LLLLLLL.#L#L##LLL#L#LLLLLLL#
...LL#LL..#...L..L..#.............L..L...L..#.L.L..#L#.L.....L.#.L.#.L..#.L#.L..#.L..#LL..LL...#LL
#L#L#.L##L.LLLL.LL#L.LL#L#.L#L.L#L.L#L#L#L#L.L#.L#LL.LL#L.L#L#LLL#LLL.#LLLLL..LLLL#LL.#L#LL#L#LLL#
LLLLLLLLLL.#.LL.#L#LL#.LLL.#LL#L#L.LLLLLLLLL.LLLLLLL#LLLL#LLL..#.LL##.LL#L.#L.#L#LLL#.LLL#LLLLL#LL
.L#L#L#L##.LL#L.LLLL.LL#L#.LL.LLLL.#L#L#L#L#.L#L#L#L.#L#LLLL#LLLL#LLLL#LLLLL#.LLL#LLL.L#.LL#L#LLL#
#LLLL.LLLL.#LLL.#L#L.#LLLLL#L.#L#L.LLLLLLLLL.#LLLLL#.LLL#L#LLL.#LLL##.LL#L#LLL#LLLL#L.LL##LLLLL#LL
LL#L..LL##LLL#L.LLLL.LL.L#..LLLLLL.#L#L#L#.L.LL#L#LL.##L.LL#L#.LL#LLLL#L.LLLLLLL#LLLL.#LLL.L#LLLL#
#LLL#L.LLL.#LLL.#L#L.#L#LL.L#L...#LLLLLLLLL#L#LLLLL#LLL#L#LLLLL#LL#L#.#LLLLL#.LL#L##L.#L#L#LLL#LLL
LL#LL.#L##.LL#L.LLLL.LLLL#.LLL#LLL.#L#L#L#LL.LLL##LL.#L#L#L#L#LLLLLLL.#L#L#LL.#LLLLLL.LL.LLL.LLL##
LLLL#LLL#L#L#LL#L.#L.#L#L#.L#LLL#L.LLLLLL#L##L#L#L#L#LLLLLLLLL##L#L#LLLLLLLL#.LLL#L#L.L#LL#L#L#LLL
#L#LLLLLLL..#L#.LLLL.LLLL#.LLL#LLL.LL.#LLLLLL.LLLL#L.L#L#L#L#L.LL#L#L#L#L#L#L.L#L#L#L.L#L#LLLLLLL#
.LL..#....L..L#....L.......L........#L......L...#..............L.L...L.#....L#LL.....L......#L#..L
LL#LL.L###.LLLL.##L#.LLLL#LLL#L#L#.L#L##L#L#.L#L##L#LLLLL.LLL..#L#LLLLLLLL#L#.LL#L#L#L#L#L#LLLLLL#
#LLL#.LLLL#L#L#.LLLLL#L#LL.#L.LLL#.LLLLLLLL#LL#LLLLL.##L#L#L##.LLLL#L.#LL.LLLL#L#LLLL.#LLLLLL#L#LL
LL#LL.LL#L.LLLLL#L#LLLLLL#.LLLL#LL.#L.L#L#LL.LL#L#L.LLLL#L#LLL.#L#LLL.#L#L#L#.LLLL#L#.LL#L#L#.LLL#
#LL#L.#LLL.#L#L.LLLL#LL#LL.#L#LLL#.LL#LLLLL#L#LLLLL#L#LLLLLL#LLLLLL#L.LLLLLLL.#L#LLLL.#LLLLLLLL#LL
L#LLL.LL#LLLLLL.#L#L.#LLL#.LLLL#L..#LLL#L#LL.LLL##LLLLL#L#L#LL.#L#LLL#L#L#L#L.LLLL#L#LLLL#L.#L#LL#
...#.L.L.LL#..L......LL#.L..#......L...LLL....#....#..LL.#.L..L..L......L.....L#.L.....#........L.
#L.LLL#L.#.LL#L.LLLL.#LLLL.LLL.LLL.##LL#L#L#.LLLLLLL.##LLLLL#..L#L#L#.LLLL#LL.#LL#LLL.L.LLLLL#L#LL
LL#L#.LLLL.#L#L#L#L#LLL#L#.L#L##L#.L.#LLLLL..#L##L##.LLL#L#LLL.#LLLLL.#L#LLL#.LL#LL#L#LLL#L#L#LLL#
#LLLL.#L#..LLLLLLLLL.#.LLL.LLLLLLL.#LL#L#LLL.LLLLLLLL##LLLLL##.LL#L##.LLLL#LLL#LLL#LL.L#LLLLLLL#LL
LL#L#.LL#..LL#L#L#L#LLLLL#L#L#L#L#.L#LLLLL#L##L#.L#..LLL#L##.L.L#L.LL.L#L#L.#LLL#LLL#LLLL#L#L#LLL#
#LLLL.#LLL.#LLLLLLLL.#L#L#.LLLLLLL.LLL#L#LLL.LLLLLLL.#L#LL.LL#LLLL#LL.LLLLLLL.#LLL#LL.#.LLLLLLL#LL
LL#L#LL#L#LLL#L.#L#L.LLLLL.L#L#L#L.L#LLLLL#LLL#L##L#.LLLL#L#LL.##LLL#L#L#L#L#.LL#LLL#.LLL#L#L#.LL.
#LLLL.LLLL.#LLL.LLLL.L#L#L#LLLLLLL#LLL#L#LLL#LLLLLLL.L#LLLLLL#.LLL#LLL#LLLLLL.#LLL#LLL#.LLLLLLL.L#
L#L#L#.L#LLLL#L#L#L#.L#L#L#L#L#L#..L#LLL#L#L.#LL#L#L#LLL#L#L#L.##LLL#.LLL#L#LLLL#L#LL.#L#L#L#L##LL
...L...L...#...LL...LL.L.L..LL..L....L#...L#LL.L........#......L..L....#.L....#...L.L.L.LLL.#..L.#
#L#LL.#.L#.LLLL.#L#L.#L#L#L#LLL#LLL#L.LLL#LL.##LL.LL.#L.LLLLLL.#LLLL#.LLLL#L#LLLL#L#L.L#L#LLLLLLLL
LLLL#.LLLL.#L#L.LLLLLLLLLLL#L#L#L#LLL#L#L.L#.LLL##L#LLL#L#L#L#LLL#L#L.#L#L#LLL#.LLLLL.LLLLL#L#L#L#
#L#LL.#L#L.LLLL#LL#L.#L#L#.LLLL.LL.#LLLLLLLL.##LLLLL.#LLLLLLLLL#LLLLL.LLLLLL#.LLL#L#L#L#L#LLLLLLLL
LLLL#LLLLL.#L#L.#LLL.LLLLL.#LL#L##.LL#L#L#L#.LLL##L#LLL#L#L#L#.LL#L#L#L#L#L#L.L#LLLLLLLLLL.#L#L#L#
#L#LL.#L#L.LLL#.LL#L#L#L#LLL#L.LLL.#LLLLLLLL.##LLLLL.#LLLLLLLL.L#LLLLLLLLLLLL.LLL#L#L.#L#LLLLLLLLL
LLLL#.LLLL#L#LL.#LLLLLLLLL#LLLL#L#LLL#L#L#L#.LLL##L#.LL#L#L#L#.LLL#L.L#LL#L#L#L#LLLLL.#LLL#L#L.#L#
#L#LL.#L#LLLLL#LL#LL#L#L#LLLL#LLLL.#LLLLLLLLLL#LLLLLL#.LLLLLLL.L.LLL#LLL#LLLLLLLL#L#LLLL#LLLLLLLLL
LLL#L.LLLL#L#LL.LL.L.LLLL#L#LLL#L#.LL#L#LL#L#LLL#L#L#LL#L#L#L#LL#L#LL.#LLL#LL.#L#LLL..#LLL#L#L#LL#
#L.L...L#..LL..L..#.L....L...#..L..LL......LL.#.......L..LL........L#.LL#LL.......L.....#L.LL.....
LL#LL.#LLLLL#.L.#LLL.##L#L.LLLLLLL.#LLLLL#L#LLLLLLLL.#LL#L#L#..LLLLLL.#LLL#LL#L#L#.L#.LLLLL#L#L#LL
#LLL#.LL#L#LL.L.L#L#.LLLLL.#L#L#L#.LL#L#LLLL.##L##L#.LL#LLLLLLL#L#L#LLLL#LLL#.L#LLLLL.L#L#LLLLLLL#
LL#LL.#LLL.#L#L#LLLLL.#L#L.L.LLLLL.#LLLLL#L#.LLLLLLL.L#L.LL#L#.LLLLLL.#LLL#LLLLLLL#L#.LLLLL#L#L#LL
#LL.#.LL#LLLLLL.L#L#LLLLLLLL#L#L#L.LL#L#L.LL.L#L#L#L.LLL#L#LLL.L#L#L#.#L#LLL#.LL#LLLL.L#L#L#LL.LL#
..#.L....#L.L#.....L.#L......L.LL..#LLLLL......LL.L.L#.LLL...#LLL......L.L.L...#L..#..L..L...L#..L
LLLL#.LLLLL#LLL.LL#..LLLL#.LL#L#L#.L#L#L#L#L.#L#L#L#..LL#LL#LL.#L#LLL#L#.L###.LLL#LLL.#L#L#L#L.LL#
#L#L..L#L#.LL#L.#LLL.#L#LL.#LLLLLLLLLLLLLLLLLLLLLLLL.L#LLL#LL#.LLLLL#.LLLLLLL.#L#LLL#LLLLLLLLLL#LL
LL#.L.LLLL.#LLL.LL#L.LLLL#.L#L#L#L.#L#L#L#L#L#LL#L.#.LLL#LLL#LL#LL#LL.#L#L#LL.LLLL#LL.#LL#L#L#L.L#
#.LL..#L#L.L.#LL#LLL##L#LL.LLLLLLL.LLLLLLLL..LLL.LLL.L#LLL#.LL.LL#LL#.LLLLLL#L#L#LLL#.LL#LLLLLLLLL
LL##L.LLLL.#L.#.LL#L.LLL#L.L#L#L#L#L#L#L#LLL#L#LL#L#.LLL#.LLL#L#LLL#..L#L#LLL.LLLL#LL.#LLL#L#LL#L#
#....L...L..#.L...L....L......L..L#L..L..L#.LL.#.L....#..L.#.LLL.#.LLLL.........#..L#.LL#......L..
LLLLL.#L#L.LLLL.L#LL.##LLL.#L#LLLL.#L#LLLLLLLLLLLL#L.LLLLL.LL#L#LLLL#L#L#L#L#.LLLLLLL.LLLLLLLLL#.L
#L#L#.LL#..L#L#.LLL#.LLL#L.LL#L#L#.LL#L#L#LL#.L#L#.L#L#L#L#LLLLLL#L#L.#L#L#LL.#L#L#L#.L#L#L#L#L.L#
LLLLL.#LLLLL.LL.#LLL.#LLLL.#LLLLLL.L.LLLLLLL.LLLLLLLLLLLLLLL#L#LLLLLLLLLLLLL#LLLLLLLL.LLLLLLLLLLLL
#L#L#.LL#L.#L#LLL#L#.LL#L#.L#L#L#L.L#L#L#L#.L#L#L#L#.L#L#L#LLL.L#L#L#.L#.L#LLL#L#L#L#.L#L#L#L#L#L#
LLLLL.LLLL.LLLL.LLLL.#LLLL.LLLLLLL.LLLLLLLLLLLLLLLLL.LLLLLLLL#.LLLLLL.LLLLLL#.LLLLLLLLLLLLLLLLLLLL
#L#L#L#L#L#L.#L#L#L#.L#L#L#.L#L#L#L#L#L#L#L#.L#L##.L#L#L#L#L#L.#L#L#L#L#L#L#L.#L#L#L#.L#L#L#L#L#L#

there are 2059 occupied seats
```

ç¬¬ 11 å¤© AOC åˆ°æ­¤ç»“æŸï¼
